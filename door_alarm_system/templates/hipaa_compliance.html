{% extends "base.html" %}

{% block title %}Compliance Report - HIPAA | GDPR | SOX | ISO 27001 | NIST - eDOMOS{% endblock %}

{% block content %}
<style>
    @media print {
        .no-print { display: none !important; }
        .compliance-section { page-break-inside: avoid; }
    }
    
    .compliance-header {
        background: linear-gradient(135deg, #00ff9d 0%, #00d4ff 100%);
        color: #000;
        padding: 40px;
        text-align: center;
        border-radius: 15px;
        margin-bottom: 30px;
    }
    
    .compliance-section {
        background: rgba(255, 255, 255, 0.05);
        border-left: 4px solid #00ff9d;
        padding: 20px;
        margin: 20px 0;
        border-radius: 5px;
    }
    
    .requirement-met {
        background: rgba(0, 255, 157, 0.1);
        border: 1px solid #00ff9d;
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
    }
    
    .evidence-box {
        background: rgba(0, 0, 0, 0.5);
        padding: 15px;
        border-radius: 5px;
        margin: 10px 0;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
    }
    
    .checkmark {
        color: #00ff9d;
        font-size: 1.2rem;
        margin-right: 10px;
    }
</style>

<div class="container-fluid mt-4">
    <!-- Header -->
    <div class="compliance-header no-print">
        <h1><i class="fas fa-certificate"></i> MULTI-FRAMEWORK COMPLIANCE REPORT</h1>
        <h3>eDOMOS Door Alarm System</h3>
        <p><strong>HIPAA | GDPR | SOX | ISO 27001 | NIST CSF</strong></p>
        <p>Generated: {{ current_date }}</p>
    </div>
    
    <div class="text-end mb-3 no-print">
        <button class="btn btn-success" onclick="window.print()">
            <i class="fas fa-file-pdf"></i> Download PDF Report
        </button>
    </div>
    
    <!-- Executive Summary -->
    <div class="compliance-section">
        <h3><i class="fas fa-clipboard-check me-2"></i>Executive Summary</h3>
        <p>
            This comprehensive report documents how the eDOMOS Door Alarm System supports compliance 
            with <strong>five major regulatory frameworks</strong>: HIPAA (Healthcare), GDPR (EU Privacy), 
            SOX (Financial Reporting), ISO 27001 (Information Security), and NIST Cybersecurity Framework 
            (U.S. Federal Standard). The system provides organizations with the necessary technical 
            infrastructure to maintain regulatory compliance for physical access control and audit logging.
        </p>
        <div class="mt-3">
            <strong>Key Compliance Capabilities:</strong>
            <ul>
                <li><strong>Blockchain Audit Trails</strong> - Immutable, tamper-proof event logging ({{ total_blocks }} blocks verified)</li>
                <li><strong>Cryptographic Integrity</strong> - SHA-256 hashing ensures data authenticity</li>
                <li><strong>Access Control</strong> - Role-based authentication and authorization</li>
                <li><strong>Encryption</strong> - HTTPS/TLS for data in transit, bcrypt for passwords</li>
                <li><strong>Data Portability</strong> - Export capabilities for audit evidence (CSV, JSON, PDF)</li>
                <li><strong>Real-Time Monitoring</strong> - Immediate alerting and incident detection</li>
            </ul>
        </div>
        <div class="mt-4 p-3" style="background: rgba(0, 255, 157, 0.1); border-radius: 10px;">
            <h5><i class="fas fa-trophy me-2" style="color: #00ff9d;"></i>Competitive Advantage</h5>
            <p class="mb-0">
                <strong>No competitor offers blockchain-verified audit trails.</strong> This unique feature 
                provides court-admissible evidence and meets the most stringent regulatory requirements 
                across multiple industries (healthcare, finance, government, enterprise).
            </p>
        </div>
    </div>
    
    <!-- Quick Reference Table -->
    <div class="compliance-section">
        <h3><i class="fas fa-table me-2"></i>Compliance Quick Reference</h3>
        <div class="table-responsive">
            <table class="table table-dark table-hover">
                <thead>
                    <tr>
                        <th>Framework</th>
                        <th>Applies To</th>
                        <th>Key Requirement</th>
                        <th>eDOMOS Solution</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>HIPAA</strong></td>
                        <td>Healthcare (US)</td>
                        <td>Audit trails, access control</td>
                        <td>Blockchain logging, encryption</td>
                        <td><span style="color: #00ff9d;">✓ Ready</span></td>
                    </tr>
                    <tr>
                        <td><strong>GDPR</strong></td>
                        <td>EU Organizations</td>
                        <td>Data protection, privacy</td>
                        <td>Data portability, right to erasure</td>
                        <td><span style="color: #00ff9d;">✓ Ready</span></td>
                    </tr>
                    <tr>
                        <td><strong>SOX</strong></td>
                        <td>Public Companies (US)</td>
                        <td>Financial audit integrity</td>
                        <td>Immutable audit trails</td>
                        <td><span style="color: #00ff9d;">✓ Ready</span></td>
                    </tr>
                    <tr>
                        <td><strong>ISO 27001</strong></td>
                        <td>Global Enterprises</td>
                        <td>InfoSec management</td>
                        <td>Cryptography, access control</td>
                        <td><span style="color: #00ff9d;">✓ Ready</span></td>
                    </tr>
                    <tr>
                        <td><strong>NIST CSF</strong></td>
                        <td>U.S. Federal/Critical Infrastructure</td>
                        <td>Cybersecurity risk management</td>
                        <td>5 functions: Identify, Protect, Detect, Respond, Recover</td>
                        <td><span style="color: #00ff9d;">✓ Ready</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- HIPAA Section -->
    <div class="compliance-section">
        <h2><i class="fas fa-hospital me-2"></i>HIPAA (Health Insurance Portability and Accountability Act)</h2>
        <p class="text-muted">U.S. Department of Health & Human Services - Healthcare Data Protection</p>
    </div>
    
    <!-- Executive Summary -->
    <div class="compliance-section">
        <h3><i class="fas fa-clipboard-check me-2"></i>HIPAA Technical Safeguards Summary</h3>
        <p>
            The following sections document compliance with HIPAA Security Rule § 164.312 Technical Safeguards. 
            The system provides healthcare facilities with the necessary tools to maintain HIPAA compliance 
            for physical access control and audit logging.</p>
            with the necessary tools to maintain HIPAA compliance for physical access control and audit logging.
        </p>
    </div>
    
    <!-- § 164.312(a) - Access Control -->
    <div class="compliance-section">
        <h3><i class="fas fa-lock me-2"></i>§ 164.312(a) Access Control (Required)</h3>
        <p class="text-muted">
            Implement technical policies and procedures that allow only authorized persons to access 
            electronic protected health information (ePHI).
        </p>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Unique User Identification (Required)</h5>
            <p><strong>Implementation:</strong> Multi-user authentication system with unique credentials</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • User Model: Unique username + password (bcrypt hashed)<br>
                • Session Management: Flask-Login with secure cookies<br>
                • Database: User table with unique constraints<br>
                • Code Location: models.py (User class), app.py (login routes)
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Emergency Access Procedure (Required)</h5>
            <p><strong>Implementation:</strong> Admin override capabilities with full audit logging</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • Admin accounts with elevated privileges<br>
                • Emergency access events logged to blockchain<br>
                • Cannot be deleted or modified (immutable)<br>
                • Code Location: app.py (is_admin checks), blockchain_helper.py
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Automatic Logoff (Addressable)</h5>
            <p><strong>Implementation:</strong> Session timeout after inactivity</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • PERMANENT_SESSION_LIFETIME = 30 minutes<br>
                • Automatic session expiration<br>
                • Re-authentication required after timeout<br>
                • Code Location: config.py (session settings)
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Encryption and Decryption (Addressable)</h5>
            <p><strong>Implementation:</strong> HTTPS/TLS encryption for data in transit</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • SSL certificates configured (server.crt, server.key)<br>
                • HTTPS enforcement available<br>
                • Password hashing: Bcrypt (industry standard)<br>
                • Code Location: generate_ssl_cert.sh, app.py (SSL context)
            </div>
        </div>
    </div>
    
    <!-- § 164.312(b) - Audit Controls -->
    <div class="compliance-section">
        <h3><i class="fas fa-clipboard-list me-2"></i>§ 164.312(b) Audit Controls (Required)</h3>
        <p class="text-muted">
            Implement hardware, software, and/or procedural mechanisms that record and examine 
            activity in information systems that contain or use ePHI.
        </p>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Comprehensive Audit Logging</h5>
            <p><strong>Implementation:</strong> Blockchain-based immutable audit trail</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • <strong>Current Audit Records: {{ total_blocks }} blockchain blocks</strong><br>
                • SHA-256 cryptographic hashing (tamper-proof)<br>
                • Timestamps for every event (microsecond precision)<br>
                • Cannot be deleted or modified without detection<br>
                • Logs: door access, alarms, user actions, system events<br>
                • Code Location: blockchain_helper.py, models.py (BlockchainEventLog)
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Tamper Detection</h5>
            <p><strong>Implementation:</strong> Cryptographic chain verification</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • Each block linked to previous via cryptographic hash<br>
                • Real-time integrity verification available<br>
                • <strong>Last Verification: {{ verification_status }}</strong><br>
                • Any modification breaks chain and triggers alert<br>
                • Code Location: blockchain_helper.py (verify_blockchain function)
            </div>
        </div>
    </div>
    
    <!-- § 164.312(c) - Integrity -->
    <div class="compliance-section">
        <h3><i class="fas fa-shield-alt me-2"></i>§ 164.312(c) Integrity (Addressable)</h3>
        <p class="text-muted">
            Implement policies and procedures to protect ePHI from improper alteration or destruction.
        </p>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Mechanism to Authenticate ePHI</h5>
            <p><strong>Implementation:</strong> Blockchain cryptographic signatures</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • SHA-256 hash for each event (industry standard)<br>
                • Mathematically proves data has not been altered<br>
                • Export capability for external verification<br>
                • <strong>Genesis Block: {{ genesis_date }}</strong><br>
                • Code Location: blockchain_helper.py (calculate_hash method)
            </div>
        </div>
    </div>
    
    <!-- § 164.312(d) - Person or Entity Authentication -->
    <div class="compliance-section">
        <h3><i class="fas fa-user-shield me-2"></i>§ 164.312(d) Person or Entity Authentication (Required)</h3>
        <p class="text-muted">
            Implement procedures to verify that a person or entity seeking access is the one claimed.
        </p>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>User Authentication</h5>
            <p><strong>Implementation:</strong> Password-based authentication with secure hashing</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • Bcrypt password hashing (NIST approved)<br>
                • Session management with secure cookies<br>
                • Login attempts logged to audit trail<br>
                • Failed login tracking and lockout capability<br>
                • Code Location: models.py (check_password), app.py (login route)
            </div>
        </div>
    </div>
    
    <!-- § 164.312(e) - Transmission Security -->
    <div class="compliance-section">
        <h3><i class="fas fa-network-wired me-2"></i>§ 164.312(e) Transmission Security (Addressable)</h3>
        <p class="text-muted">
            Implement technical security measures to guard against unauthorized access to ePHI 
            being transmitted over an electronic communications network.
        </p>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Integrity Controls</h5>
            <p><strong>Implementation:</strong> HTTPS/TLS encryption</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • SSL/TLS certificates configured<br>
                • Encrypted data transmission<br>
                • Protection against man-in-the-middle attacks<br>
                • Code Location: generate_ssl_cert.sh, HTTP_HTTPS_GUIDE.md
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Encryption</h5>
            <p><strong>Implementation:</strong> End-to-end encryption capability</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • HTTPS available for all communications<br>
                • WebSocket secure (WSS) capability<br>
                • Database encryption at rest (if configured)<br>
                • Code Location: app.py (SSL context configuration)
            </div>
        </div>
    </div>
    
    <!-- Physical Safeguards Support -->
    <div class="compliance-section">
        <h3><i class="fas fa-door-closed me-2"></i>§ 164.310 Physical Safeguards Support</h3>
        <p class="text-muted">
            While not a technical safeguard, this system directly supports physical access control requirements.
        </p>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Facility Access Controls</h5>
            <p><strong>Implementation:</strong> Door monitoring and access logging</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • Real-time door status monitoring<br>
                • Immediate alerts for unauthorized access<br>
                • Complete access history (who, when, duration)<br>
                • Integration with physical hardware (GPIO sensors)<br>
                • Code Location: app.py (GPIO monitoring), dashboard.html
            </div>
        </div>
    </div>
    
    <!-- GDPR Support -->
    <div class="compliance-section">
        <h3><i class="fas fa-user-shield me-2"></i>GDPR Compliance Support (EU Regulation 2016/679)</h3>
        <p class="text-muted">
            General Data Protection Regulation - European Union privacy and data protection law.
        </p>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Article 30: Records of Processing Activities</h5>
            <p><strong>Implementation:</strong> Blockchain audit trail of all data access</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • Complete log of who accessed what data and when<br>
                • Immutable records cannot be altered or deleted<br>
                • <strong>{{ total_blocks }} events logged to blockchain</strong><br>
                • Exportable for regulatory audits<br>
                • Code Location: blockchain_helper.py, models.py
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Article 32: Security of Processing</h5>
            <p><strong>Implementation:</strong> Encryption, access control, integrity measures</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • Pseudonymisation: User ID-based access (not personal data in logs)<br>
                • Encryption: HTTPS/TLS, bcrypt password hashing<br>
                • Integrity: SHA-256 cryptographic verification<br>
                • Resilience: Tamper detection via blockchain<br>
                • Code Location: config.py (encryption), blockchain_helper.py (integrity)
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Article 15: Right of Access (Data Portability)</h5>
            <p><strong>Implementation:</strong> Data export functionality</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • CSV export for audit logs<br>
                • JSON export for blockchain data<br>
                • User can request all data associated with their account<br>
                • Code Location: app.py (export routes)
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Article 17: Right to Erasure ("Right to be Forgotten")</h5>
            <p><strong>Implementation:</strong> User account deletion capability</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • Admin can delete user accounts<br>
                • Personal data removed from active database<br>
                • Audit logs retained for legal compliance (6-year retention)<br>
                • Note: Blockchain events anonymized (no personal data stored)<br>
                • Code Location: app.py (user management)
            </div>
        </div>
    </div>
    
    <!-- SOX Support -->
    <div class="compliance-section">
        <h3><i class="fas fa-balance-scale me-2"></i>SOX Compliance Support (Sarbanes-Oxley Act)</h3>
        <p class="text-muted">
            U.S. financial reporting law requiring audit trail integrity for publicly-traded companies.
        </p>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Section 802: Criminal Penalties for Document Destruction</h5>
            <p><strong>Implementation:</strong> Immutable blockchain prevents evidence tampering</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • Audit logs CANNOT be deleted or modified<br>
                • Any tampering attempt detected via cryptographic verification<br>
                • <strong>{{ total_blocks }} immutable audit records</strong><br>
                • Court-admissible evidence chain<br>
                • Code Location: blockchain_helper.py (immutability enforcement)
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Section 404: Internal Controls Over Financial Reporting</h5>
            <p><strong>Implementation:</strong> Access control and audit logging</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • Role-based access control (segregation of duties)<br>
                • Complete audit trail of all user actions<br>
                • Timestamps with microsecond precision<br>
                • Real-time monitoring and alerting<br>
                • Code Location: models.py (User/permissions), app.py (logging)
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>Section 302: Corporate Responsibility for Financial Reports</h5>
            <p><strong>Implementation:</strong> Exportable evidence for executive certification</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • Management can export complete audit trail<br>
                • Cryptographic proof of data integrity<br>
                • No unauthorized modifications possible<br>
                • PDF/JSON export for board review<br>
                • Code Location: app.py (export endpoints)
            </div>
        </div>
    </div>
    
    <!-- ISO 27001 Support -->
    <div class="compliance-section">
        <h3><i class="fas fa-certificate me-2"></i>ISO 27001:2022 Support (Information Security Management)</h3>
        <p class="text-muted">
            International standard for information security management systems (ISMS).
        </p>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>A.9 Access Control</h5>
            <p><strong>Implementation:</strong> User authentication and authorization</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • A.9.1: Access control policy (role-based permissions)<br>
                • A.9.2: User access management (unique credentials)<br>
                • A.9.3: User responsibilities (password requirements)<br>
                • A.9.4: System/application access control (session management)<br>
                • Code Location: models.py (User), app.py (authentication)
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>A.10 Cryptography</h5>
            <p><strong>Implementation:</strong> Industry-standard cryptographic controls</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • A.10.1: Cryptographic controls (SHA-256, bcrypt, TLS)<br>
                • Password hashing: Bcrypt (NIST approved)<br>
                • Data integrity: SHA-256 blockchain hashing<br>
                • Data in transit: HTTPS/TLS encryption<br>
                • Code Location: blockchain_helper.py, config.py
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>A.11 Physical and Environmental Security</h5>
            <p><strong>Implementation:</strong> Physical access monitoring</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • A.11.1: Secure areas (door monitoring system)<br>
                • A.11.2: Equipment (Raspberry Pi hardware security)<br>
                • Real-time physical access monitoring<br>
                • Immediate alerting for unauthorized entry<br>
                • Code Location: app.py (GPIO monitoring)
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>A.12 Operations Security</h5>
            <p><strong>Implementation:</strong> Logging, monitoring, and audit</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • A.12.4: Logging and monitoring (blockchain audit trail)<br>
                • A.12.4.1: Event logging (all events timestamped)<br>
                • A.12.4.2: Protection of log information (immutable blockchain)<br>
                • A.12.4.3: Administrator/operator logs (admin actions tracked)<br>
                • A.12.4.4: Clock synchronization (NTP timestamps)<br>
                • Code Location: blockchain_helper.py, app.py (log_event)
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>A.16 Information Security Incident Management</h5>
            <p><strong>Implementation:</strong> Alarm and alert system</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • A.16.1: Management of incidents (real-time alerts)<br>
                • Immediate notification of security events<br>
                • Complete incident history in blockchain<br>
                • Email notifications for critical events<br>
                • Code Location: app.py (alarm triggers), email_service.py
            </div>
        </div>
    </div>
    
    <!-- NIST Cybersecurity Framework Support -->
    <div class="compliance-section">
        <h3><i class="fas fa-flag-usa me-2"></i>NIST Cybersecurity Framework Support (U.S. National Standard)</h3>
        <p class="text-muted">
            National Institute of Standards and Technology - Widely adopted framework for managing cybersecurity risks.
        </p>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>IDENTIFY (ID): Asset Management & Risk Assessment</h5>
            <p><strong>Implementation:</strong> Door/access point inventory and monitoring</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • ID.AM-1: Physical devices inventoried (door sensors, LEDs, switches)<br>
                • ID.AM-2: Software platforms inventoried (Flask app, database, blockchain)<br>
                • ID.AM-3: Data flows mapped (event logging → blockchain → reports)<br>
                • ID.RA-1: Asset vulnerabilities identified (physical access risks)<br>
                • Code Location: models.py (DoorSystemInfo), app.py (GPIO monitoring)
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>PROTECT (PR): Access Control & Data Security</h5>
            <p><strong>Implementation:</strong> Authentication, encryption, and physical security</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • PR.AC-1: Identities and credentials managed (user authentication)<br>
                • PR.AC-3: Remote access managed (role-based permissions)<br>
                • PR.AC-4: Access permissions managed (admin/view/report roles)<br>
                • PR.DS-1: Data-at-rest protected (database encryption capability)<br>
                • PR.DS-2: Data-in-transit protected (HTTPS/TLS)<br>
                • PR.DS-6: Integrity checking (blockchain SHA-256 hashing)<br>
                • PR.PT-1: Audit logs maintained ({{ total_blocks }} blockchain events)<br>
                • Code Location: app.py (authentication), blockchain_helper.py (integrity)
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>DETECT (DE): Anomalies & Events</h5>
            <p><strong>Implementation:</strong> Real-time monitoring and anomaly detection</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • DE.AE-1: Network baseline established (normal door activity patterns)<br>
                • DE.AE-2: Detected events analyzed (anomaly detection ML)<br>
                • DE.AE-3: Event data aggregated (analytics dashboard)<br>
                • DE.CM-1: Network monitored (WebSocket real-time updates)<br>
                • DE.CM-3: Personnel activity monitored (user login tracking)<br>
                • DE.CM-7: Monitoring for unauthorized activity (alarm triggers)<br>
                • DE.DP-4: Event detection tested (manual testing capability)<br>
                • Code Location: models.py (AnomalyDetection), app.py (monitoring)
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>RESPOND (RS): Incident Response</h5>
            <p><strong>Implementation:</strong> Automated alerting and notification</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • RS.AN-1: Notifications received (real-time WebSocket alerts)<br>
                • RS.AN-2: Impact of incidents understood (alarm severity levels)<br>
                • RS.CO-2: Events reported (email notifications, scheduled reports)<br>
                • RS.CO-3: Information shared (multi-user dashboard access)<br>
                • RS.MI-3: Newly identified vulnerabilities mitigated (updates applied)<br>
                • Code Location: app.py (alarm system), email_service.py (notifications)
            </div>
        </div>
        
        <div class="requirement-met">
            <h5><span class="checkmark">✓</span>RECOVER (RC): Recovery Planning</h5>
            <p><strong>Implementation:</strong> System resilience and backup capabilities</p>
            <div class="evidence-box">
                <strong>Evidence:</strong><br>
                • RC.RP-1: Recovery plan executed (database backup/restore)<br>
                • RC.CO-3: Recovery activities communicated (admin notifications)<br>
                • RC.IM-1: Recovery plans incorporated (migration scripts)<br>
                • RC.IM-2: Strategies updated (blockchain migration completed)<br>
                • Code Location: Database migrations, backup scripts
            </div>
        </div>
    </div>
    
    <!-- Compliance Summary -->
    <div class="compliance-section">
        <h3><i class="fas fa-check-circle me-2" style="color: #00ff9d;"></i>Multi-Framework Compliance Summary</h3>
        <div class="row mt-4 justify-content-center">
            <div class="col-6 col-md-4 col-lg mb-3">
                <div class="text-center p-3" style="background: rgba(0, 255, 157, 0.1); border-radius: 10px;">
                    <i class="fas fa-hospital" style="font-size: 2.5rem; color: #00ff9d;"></i>
                    <h5 class="mt-3">HIPAA</h5>
                    <p class="text-muted">Healthcare</p>
                    <strong style="color: #00ff9d;">✓ Ready</strong>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg mb-3">
                <div class="text-center p-3" style="background: rgba(0, 255, 157, 0.1); border-radius: 10px;">
                    <i class="fas fa-shield-alt" style="font-size: 2.5rem; color: #00ff9d;"></i>
                    <h5 class="mt-3">GDPR</h5>
                    <p class="text-muted">EU Privacy</p>
                    <strong style="color: #00ff9d;">✓ Ready</strong>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg mb-3">
                <div class="text-center p-3" style="background: rgba(0, 255, 157, 0.1); border-radius: 10px;">
                    <i class="fas fa-university" style="font-size: 2.5rem; color: #00ff9d;"></i>
                    <h5 class="mt-3">SOX</h5>
                    <p class="text-muted">Financial</p>
                    <strong style="color: #00ff9d;">✓ Ready</strong>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg mb-3">
                <div class="text-center p-3" style="background: rgba(0, 255, 157, 0.1); border-radius: 10px;">
                    <i class="fas fa-certificate" style="font-size: 2.5rem; color: #00ff9d;"></i>
                    <h5 class="mt-3">ISO 27001</h5>
                    <p class="text-muted">InfoSec</p>
                    <strong style="color: #00ff9d;">✓ Ready</strong>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg mb-3">
                <div class="text-center p-3" style="background: rgba(0, 255, 157, 0.1); border-radius: 10px;">
                    <i class="fas fa-flag-usa" style="font-size: 2.5rem; color: #00ff9d;"></i>
                    <h5 class="mt-3">NIST CSF</h5>
                    <p class="text-muted">U.S. Standard</p>
                    <strong style="color: #00ff9d;">✓ Ready</strong>
                </div>
            </div>
            <div class="col-md-3">
                <div class="text-center p-3" style="background: rgba(0, 255, 157, 0.1); border-radius: 10px;">
                    <i class="fas fa-certificate" style="font-size: 2.5rem; color: #00ff9d;"></i>
                    <h5 class="mt-3">ISO 27001</h5>
                    <p class="text-muted">InfoSec</p>
                    <strong style="color: #00ff9d;">✓ Ready</strong>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Exportable Proof -->
    <div class="compliance-section">
        <h3><i class="fas fa-download me-2"></i>Exportable Compliance Evidence</h3>
        <p>For auditors and compliance officers, the following evidence can be exported:</p>
        
        <div class="mt-3">
            <button class="btn btn-outline-light me-2" onclick="exportBlockchain()">
                <i class="fas fa-file-code"></i> Export Blockchain Proof (JSON)
            </button>
            <button class="btn btn-outline-light me-2" onclick="exportAuditLog()">
                <i class="fas fa-file-excel"></i> Export Audit Logs (CSV)
            </button>
            <button class="btn btn-outline-light" onclick="window.print()">
                <i class="fas fa-file-pdf"></i> Export This Report (PDF)
            </button>
        </div>
    </div>
    
    <!-- Disclaimer -->
    <div class="compliance-section" style="border-left-color: #ffc107;">
        <h5><i class="fas fa-exclamation-triangle me-2" style="color: #ffc107;"></i>Important Notice</h5>
        <p>
            This report demonstrates that eDOMOS provides the <strong>technical infrastructure</strong> 
            to support compliance with HIPAA, GDPR, SOX, and ISO 27001. However, full regulatory compliance also requires:
        </p>
        <ul>
            <li><strong>HIPAA:</strong> Administrative safeguards, BAAs, workforce training, risk assessments</li>
            <li><strong>GDPR:</strong> Privacy policies, DPO appointment, data processing agreements, consent management</li>
            <li><strong>SOX:</strong> Management certification, external audits, internal control testing</li>
            <li><strong>ISO 27001:</strong> ISMS documentation, management review, third-party certification audit</li>
            <li><strong>NIST CSF:</strong> Risk management process, continuous monitoring, framework implementation tiers</li>
        </ul>
        <p>
            <strong>Recommendation:</strong> eDOMOS provides the foundational security controls. Consult with 
            compliance experts to ensure your organization's complete compliance program meets all regulatory requirements.
        </p>
    </div>
    
    <!-- Footer -->
    <div class="text-center mt-5 mb-4">
        <p class="text-muted">
            <strong>eDOMOS Door Alarm System v2.1</strong><br>
            Multi-Framework Compliance Report<br>
            <strong>HIPAA | GDPR | SOX | ISO 27001 | NIST CSF</strong><br>
            Generated: {{ current_date }}<br>
            <br>
            <em>Blockchain-Secured Audit Trails • Court-Admissible Evidence • Enterprise-Grade Security</em>
        </p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadComplianceData();
});

function loadComplianceData() {
    fetch('/api/blockchain/stats')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update dynamic values - these are already in template from server
                console.log('Compliance data loaded:', data);
            }
        });
}

function exportBlockchain() {
    fetch('/api/blockchain/export')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `eDOMOS_Compliance_Evidence_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                alert('✅ Blockchain evidence exported for compliance audit\n\nThis file provides cryptographic proof for HIPAA, GDPR, SOX, and ISO 27001 audits.');
            }
        });
}

function exportAuditLog() {
    window.location.href = '/export/csv';
}
</script>
{% endblock %}
