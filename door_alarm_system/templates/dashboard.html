{% extends "base.html" %}

{% block title %}eDOMOS Industrial Control System{% endblock %}

{% block content %}
<a href="#main-content" class="skip-to-content">Skip to main content</a>

<div class="container-fluid dashboard-container">
    
    <!-- Industrial System Info Bar - Essentials Only -->
    <div class="system-info-bar">
        <div class="info-section">
            <i class="fas fa-microchip"></i>
            <span class="info-label">SYSTEM</span>
            <span class="info-value">eDOMOS 21 CFR Part 11</span>
        </div>
        <div class="info-section">
            <i class="fas fa-clock"></i>
            <span class="info-label">UPTIME</span>
            <span class="info-value" id="systemUptime">--:--:--</span>
        </div>
        <div class="info-section">
            <i class="fas fa-wifi"></i>
            <span class="info-label">CONNECTION</span>
            <span class="connection-status" id="connectionStatus">
                <span class="status-dot status-online"></span>
                <span class="status-text">Online</span>
            </span>
        </div>
        <div class="info-section ms-auto">
            <button class="btn btn-sm btn-system-refresh" onclick="manualRefresh()" aria-label="Refresh dashboard data">
                <i class="fas fa-redo"></i> REFRESH
            </button>
        </div>
    </div>

    <!-- Section Header - Professional & Clear -->
    <div class="section-header">
        <div class="section-title-wrapper">
            <div class="section-icon-badge">
                <i class="fas fa-shield-alt"></i>
            </div>
            <div>
                <h1 class="section-title">Security Monitoring Dashboard</h1>
                <p class="section-subtitle">Real-time Door Access & Alarm Control</p>
            </div>
        </div>
        <div class="section-actions">
            <!-- System Status Indicators -->
            <div class="status-badge-group">
                <div class="status-badge system-operational" id="systemStatusBadge" role="status" aria-live="polite" aria-label="System status">
                    <i class="fas fa-check-circle"></i>
                    <span id="systemStatusText">All Systems Operational</span>
                </div>
                <div class="status-badge blockchain-secure" id="blockchainBadge" role="status" aria-label="Blockchain security status" style="display: none;">
                    <i class="fas fa-link"></i>
                    <span>Blockchain Secured</span>
                    <span class="badge-count" id="blockchainBlockCount" aria-label="Blockchain blocks verified">0</span>
                    <a href="/blockchain" class="badge-link" title="View Blockchain Proof" aria-label="View blockchain verification proof">
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats Overview - Customer Focused -->
    <div class="quick-stats-bar">
        <div class="stat-item" role="status" aria-label="Total events logged today">
            <i class="fas fa-list-ul"></i>
            <div class="stat-content">
                <span class="stat-label">Events Today</span>
                <span class="stat-value" id="totalEventsLogged">{{ total_events }}</span>
            </div>
        </div>
        <div class="stat-item" role="status" aria-label="Compliance status">
            <i class="fas fa-certificate"></i>
            <div class="stat-content">
                <span class="stat-label">Compliance</span>
                <span class="stat-value">21 CFR Part 11</span>
            </div>
        </div>
        <div class="stat-item" role="status" aria-label="Blockchain verification status">
            <i class="fas fa-link"></i>
            <div class="stat-content">
                <span class="stat-label">Blockchain Verified</span>
                <span class="stat-value" id="blockchainCount">{{ blockchain_blocks|default(0) }} Blocks</span>
            </div>
        </div>
    </div>

    <!-- Main Status Grid -->
    <div class="neo-grid" role="region" aria-label="System status cards" id="main-content">
        <div class="neo-card door-card" role="article" aria-labelledby="door-status-label">
            <div class="neo-glow"></div>
            <div class="card-icon-wrapper">
                <div class="icon-orbit" aria-hidden="true">
                    <i class="fas fa-door-open"></i>
                </div>
                <button class="help-icon-btn" onclick="showHelp('door-status')" aria-label="Learn more about door status">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>
            <div class="card-label" id="door-status-label">Door Status</div>
            <div class="card-value" id="door-status" role="status" aria-live="polite">{{ door_status }}</div>
            <div class="card-indicator {{ 'safe' if door_status == 'Closed' else 'alert' }}" 
                 role="img" 
                 aria-label="{{ 'Normal status' if door_status == 'Closed' else 'Alert status' }}"></div>
        </div>

        <div class="neo-card alarm-card" role="article" aria-labelledby="alarm-status-label">
            <div class="neo-glow"></div>
            <div class="card-icon-wrapper">
                <div class="icon-orbit" aria-hidden="true">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <button class="help-icon-btn" onclick="showHelp('alarm-status')" aria-label="Learn more about alarm status">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>
            <div class="card-label" id="alarm-status-label">Alarm Status</div>
            <div class="card-value" id="alarm-status" role="status" aria-live="assertive">{{ alarm_status }}</div>
            <div class="card-indicator {{ 'safe' if alarm_status == 'Inactive' else 'alert' }}"
                 role="img"
                 aria-label="{{ 'Normal status' if alarm_status == 'Inactive' else 'Alert status' }}"></div>
        </div>

        <div class="neo-card timer-card" role="article" aria-labelledby="timer-status-label">
            <div class="neo-glow"></div>
            <div class="card-icon-wrapper">
                <div class="icon-orbit" aria-hidden="true">
                    <i class="fas fa-clock"></i>
                </div>
                <button class="help-icon-btn" onclick="showHelp('timer-setting')" aria-label="Learn more about timer settings">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>
            <div class="card-label" id="timer-status-label">Timer Setting</div>
            <div class="card-value" id="timer-set" role="status">{{ timer_set }}s</div>
            <div class="card-indicator info" role="img" aria-label="Information status"></div>
        </div>

        <div class="neo-card camera-card" role="article" aria-labelledby="camera-label">
            <div class="neo-glow"></div>
            <div class="card-icon-wrapper">
                <div class="icon-orbit" aria-hidden="true">
                    <i class="fas fa-video"></i>
                </div>
                <button class="help-icon-btn" onclick="showHelp('live-camera')" aria-label="Learn more about live camera">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>
            <div class="card-label" id="camera-label">Live Camera</div>
            <div class="card-action">
                <button class="neo-btn" 
                        onclick="openLiveCamera()" 
                        id="liveCameraBtn"
                        aria-label="Open live camera feed"
                        title="Click to view live camera feed">
                    <span class="btn-bg"></span>
                    <span class="btn-text">
                        <i class="fas fa-play-circle me-2"></i>View Feed
                    </span>
                </button>
            </div>
        </div>

        <div class="neo-card events-card" role="article" aria-labelledby="events-label">
            <div class="neo-glow"></div>
            <div class="card-icon-wrapper">
                <div class="icon-orbit" aria-hidden="true">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <button class="help-icon-btn" onclick="showHelp('total-events')" aria-label="Learn more about event tracking">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>
            <div class="card-label" id="events-label">Total Events</div>
            <div class="card-value" id="total-events" role="status">{{ total_events }}</div>
            <div class="card-indicator primary" role="img" aria-label="Primary status"></div>
        </div>
    </div>

    <!-- =============================================
         AI INTELLIGENCE CENTER - Shows AI in Action
         ============================================= -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="ai-intelligence-panel">
                <!-- AI Brain Animation -->
                <div class="ai-brain-bg">
                    <div class="brain-pulse"></div>
                    <div class="brain-pulse"></div>
                    <div class="brain-pulse"></div>
                </div>
                
                <div class="ai-header">
                    <div class="ai-logo">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="ai-title-section">
                        <h2 class="ai-main-title">
                            <span class="ai-badge">AI</span>
                            INTELLIGENCE CENTER
                        </h2>
                        <p class="ai-subtitle">Real-time Machine Learning Security Analysis</p>
                    </div>
                    <div class="ai-status-badge" id="ai-status-badge">
                        <div class="status-dot pulsing"></div>
                        <span id="ai-status-text">ACTIVE</span>
                    </div>
                </div>

                <!-- AI Metrics Grid -->
                <div class="ai-metrics-container">
                    <!-- AI Accuracy -->
                    <div class="ai-metric-card">
                        <div class="ai-metric-icon">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <div class="ai-metric-content">
                            <div class="ai-metric-label">AI Accuracy</div>
                            <div class="ai-metric-value">
                                <span id="ai-accuracy-value">--</span>
                                <span class="ai-metric-unit">%</span>
                            </div>
                            <div class="ai-progress-bar">
                                <div class="ai-progress-fill" id="ai-accuracy-bar"></div>
                            </div>
                            <div class="ai-metric-info" id="ai-accuracy-info">Learning patterns...</div>
                        </div>
                    </div>

                    <!-- Threat Level -->
                    <div class="ai-metric-card">
                        <div class="ai-metric-icon threat-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="ai-metric-content">
                            <div class="ai-metric-label">Threat Level</div>
                            <div class="ai-metric-value threat-display">
                                <span id="ai-threat-value">--</span>
                            </div>
                            <div class="threat-indicator-bar">
                                <div class="threat-segment low"></div>
                                <div class="threat-segment medium"></div>
                                <div class="threat-segment high"></div>
                                <div class="threat-segment critical"></div>
                            </div>
                            <div class="ai-metric-info" id="ai-threat-info">Analyzing...</div>
                        </div>
                    </div>

                    <!-- Security Score -->
                    <div class="ai-metric-card">
                        <div class="ai-metric-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="ai-metric-content">
                            <div class="ai-metric-label">Security Score</div>
                            <div class="ai-metric-value">
                                <span id="ai-security-score">--</span>
                                <span class="score-suffix">/100</span>
                            </div>
                            <div class="security-score-bar">
                                <div class="score-fill" id="security-score-fill"></div>
                            </div>
                            <div class="ai-metric-info" id="ai-security-info">System health</div>
                        </div>
                    </div>

                    <!-- Incidents Prevented -->
                    <div class="ai-metric-card">
                        <div class="ai-metric-icon">
                            <i class="fas fa-shield-virus"></i>
                        </div>
                        <div class="ai-metric-content">
                            <div class="ai-metric-label">Incidents Prevented</div>
                            <div class="ai-metric-value">
                                <span id="ai-incidents-value">--</span>
                            </div>
                            <div class="incidents-visualization">
                                <div class="incident-icon"><i class="fas fa-ban"></i></div>
                                <div class="incident-icon"><i class="fas fa-ban"></i></div>
                                <div class="incident-icon"><i class="fas fa-ban"></i></div>
                            </div>
                            <div class="ai-metric-info" id="ai-incidents-info">Anomalies detected</div>
                        </div>
                    </div>
                </div>

                <!-- Security Alerts -->
                <div class="ai-activity-section">
                    <h3 class="ai-section-title">
                        <i class="fas fa-shield-alt"></i>
                        Security Alerts (Last 24h)
                    </h3>
                    <div class="security-alerts-feed" id="security-alerts-feed">
                        <div class="security-alert-item no-alerts">
                            <div class="alert-icon"><i class="fas fa-check-circle"></i></div>
                            <div class="alert-text">No security concerns detected</div>
                            <div class="alert-subtext">AI monitoring all systems normally</div>
                        </div>
                    </div>
                </div>

                <!-- AI Capabilities Badge -->
                <div class="ai-capabilities">
                    <div class="capability-badge">
                        <i class="fas fa-chart-line"></i>
                        <span>Anomaly Detection</span>
                    </div>
                    <div class="capability-badge">
                        <i class="fas fa-search"></i>
                        <span>Pattern Recognition</span>
                    </div>
                    <div class="capability-badge">
                        <i class="fas fa-brain"></i>
                        <span>Behavioral Learning</span>
                    </div>
                    <div class="capability-badge">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Threat Prediction</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fluid Analytics Section -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="fluid-card">
                <!-- Animated Wave Background -->
                <div class="wave-container">
                    <svg class="wave" viewBox="0 0 1200 100" preserveAspectRatio="none">
                        <path class="wave-path" d="M0,50 Q300,0 600,50 T1200,50 L1200,100 L0,100 Z" fill="url(#waveGradient)"/>
                        <defs>
                            <linearGradient id="waveGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#667eea;stop-opacity:0.3" />
                                <stop offset="50%" style="stop-color:#764ba2;stop-opacity:0.5" />
                                <stop offset="100%" style="stop-color:#f093fb;stop-opacity:0.3" />
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                
                <div class="card-header">
                    <div class="header-accent"></div>
                    <h3 class="fluid-title">
                        <i class="fas fa-chart-line me-3"></i>
                        SYSTEM ANALYTICS
                        <span class="live-pulse">‚óè LIVE</span>
                    </h3>
                </div>
                <div class="card-body">
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <div class="metric-icon door-open">
                                <i class="fas fa-door-open"></i>
                            </div>
                            <div class="metric-data">
                                <div class="metric-value" id="door-open-events">{{ door_open_events }}</div>
                                <div class="metric-label">Door Openings</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-icon door-close">
                                <i class="fas fa-door-closed"></i>
                            </div>
                            <div class="metric-data">
                                <div class="metric-value" id="door-close-events">{{ door_close_events }}</div>
                                <div class="metric-label">Door Closings</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-icon alarm">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div class="metric-data">
                                <div class="metric-value" id="alarm-events">{{ alarm_events }}</div>
                                <div class="metric-label">Alarms Triggered</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-icon uptime">
                                <i class="fas fa-server"></i>
                            </div>
                            <div class="metric-data">
                                <div class="metric-value" id="system-uptime">{{ uptime.uptime_string }}</div>
                                <div class="metric-label">System Uptime</div>
                                <div class="metric-detail" id="uptime-availability">{{ uptime.availability_percent }}% Available</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Control Center -->
    {% if 'controls' in permissions %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="control-center">
                <!-- Security effects for Mission Control -->
                <div class="hex-pattern">
                    <div class="hex-item" style="top: 20%; left: 85%;"></div>
                    <div class="hex-item" style="top: 60%; left: 10%;"></div>
                    <div class="hex-item" style="top: 75%; left: 88%;"></div>
                </div>
                
                <div class="card-header">
                    <div class="section-icon">
                        <i class="fas fa-sliders-h"></i>
                    </div>
                    <h3>MISSION CONTROL</h3>
                    <div class="status-badge">
                        <span class="pulse-dot"></span>
                        ARMED
                    </div>
                </div>
                <div class="card-body">
                    <div class="controls-grid">
                        <div class="control-item">
                            <button class="control-btn timer-btn" onclick="showTimerModal()">
                                <i class="fas fa-clock"></i>
                                <span>SET TIMER</span>
                            </button>
                        </div>
                        <div class="control-item">
                            <button class="control-btn backup-btn" onclick="backupDatabase()">
                                <i class="fas fa-database"></i>
                                <span>BACKUP DATA</span>
                            </button>
                        </div>
                        <div class="control-item">
                            <button class="control-btn auto-backup-btn" onclick="showAutoBackupModal()">
                                <i class="fas fa-sync-alt"></i>
                                <span>AUTO BACKUP</span>
                            </button>
                        </div>
                        <!-- System Test button hidden as per user request -->
                        <!-- <div class="control-item">
                            <button class="control-btn test-btn" onclick="testSystem()">
                                <i class="fas fa-vial"></i>
                                <span>SYSTEM TEST</span>
                            </button>
                        </div> -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Audio Alert System - Available to All Users -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="control-center">
                <div class="card-header">
                    <h3><i class="fas fa-volume-up me-2"></i>AUDIO ALERT SYSTEM</h3>
                </div>
                <div class="card-body">
                    <!-- Permission Status -->
                    <div class="permission-status mb-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <span class="badge" id="audioPermissionBadge">
                                    <i class="fas fa-volume-mute"></i> Audio: Checking...
                                </span>
                                <span class="badge ms-2" id="notificationPermissionBadge">
                                    <i class="fas fa-bell-slash"></i> Notifications: Checking...
                                </span>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-primary" onclick="enableMobileAudio()" id="enableAudioBtn">
                                    <i class="fas fa-volume-up"></i> Enable Audio Alerts
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Audio Controls Grid - HIDDEN FOR PRODUCTION -->
                    <div class="controls-grid" style="display: none;">
                        <div class="control-item">
                            <button class="control-btn audio-btn" onclick="testAlarmSound('default')" id="testDefaultBtn" disabled>
                                <i class="fas fa-volume-up"></i>
                                <span>TEST DEFAULT</span>
                            </button>
                        </div>
                        <div class="control-item">
                            <button class="control-btn audio-btn urgent" onclick="testAlarmSound('urgent')" id="testUrgentBtn" disabled>
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>TEST URGENT</span>
                            </button>
                        </div>
                        <div class="control-item">
                            <button class="control-btn audio-btn gentle" onclick="testAlarmSound('gentle')" id="testGentleBtn" disabled>
                                <i class="fas fa-bell"></i>
                                <span>TEST GENTLE</span>
                            </button>
                        </div>
                        <div class="control-item">
                            <button class="control-btn audio-btn stop" onclick="stopAllAlarms()" id="stopAlarmsBtn" disabled>
                                <i class="fas fa-stop"></i>
                                <span>STOP ALL</span>
                            </button>
                        </div>
                    </div>

                    <!-- Ringtone Selector - HIDDEN FOR PRODUCTION -->
                    <div class="mt-3" style="display: none;">
                        <label for="ringtoneSelect" class="form-label">
                            <i class="fas fa-music"></i> Default Alarm Sound:
                        </label>
                        <div class="d-flex align-items-center">
                            <select id="ringtoneSelect" class="form-select form-select-sm me-2" onchange="setDefaultRingtone(this.value)" disabled>
                                <option value="default">Default Beep Pattern</option>
                                <option value="urgent">Urgent Siren</option>
                                <option value="gentle">Gentle Bell</option>
                                <option value="classic">Classic Bell</option>
                                <option value="siren">Emergency Siren</option>
                            </select>
                            <button class="btn btn-sm btn-outline-primary" onclick="testSelectedRingtone()" id="testSelectedBtn" disabled>
                                <i class="fas fa-play"></i> Test
                            </button>
                            <button class="btn btn-sm btn-outline-danger ms-1" onclick="testFullAlarm()" id="testFullAlarmBtn" disabled>
                                <i class="fas fa-exclamation-triangle"></i> Test Full Alarm
                            </button>
                            <button class="btn btn-sm btn-outline-warning ms-1" onclick="testHooter()" id="testHooterBtn" disabled>
                                <i class="fas fa-volume-up"></i> Test Hooter Siren
                            </button>
                        </div>
                    </div>

                    <!-- Audio Settings - HIDDEN FOR PRODUCTION -->
                    <div class="mt-3" style="display: none;">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <label class="form-check-label">
                                    <input type="checkbox" class="form-check-input me-2" id="vibrationEnabled" checked onchange="toggleVibration(this.checked)">
                                    <i class="fas fa-mobile-alt"></i> Enable Vibration
                                </label>
                            </div>
                            <div>
                                <label class="form-check-label">
                                    <input type="checkbox" class="form-check-input me-2" id="persistentNotifications" checked onchange="togglePersistentNotifications(this.checked)">
                                    <i class="fas fa-bell"></i> Persistent Notifications
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Emergency Stop Button -->
                    <div class="mt-3 text-center">
                        <button class="btn btn-danger btn-lg w-100" onclick="emergencyStopAllAlarms()" id="emergencyStopBtn">
                            <i class="fas fa-stop-circle"></i> üö® EMERGENCY STOP ALL ALARMS üö®
                        </button>
                        <small class="text-muted d-block mt-1">Instantly stops all playing alarms and notifications</small>
                    </div>
                                    <i class="fas fa-bell"></i> Persistent Notifications
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<!-- Timer Modal -->
<div class="modal fade" id="timerModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-clock me-2"></i>Set Alarm Timer</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Timer Duration (seconds)</label>
                    <input type="number" class="form-control" id="timer-input" min="1" max="300" value="{{ timer_set }}">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="setTimer()">Set Timer</button>
            </div>
        </div>
    </div>
</div>

<!-- Auto Backup Modal -->
<div class="modal fade" id="autoBackupModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-sync-alt me-2"></i>Auto Backup Settings</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Backup Interval (minutes)</label>
                    <input type="number" class="form-control" id="backup-interval" min="5" max="1440" value="60">
                </div>
                <div class="form-group">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="auto-backup-enabled">
                        <label class="form-check-label" for="auto-backup-enabled">Enable Auto Backup</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="setAutoBackup()">Save Settings</button>
            </div>
        </div>
    </div>
</div>

<!-- Live Camera Modal -->
<div class="modal fade" id="liveCameraModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-video me-2"></i>Live Camera Feed</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <div id="cameraStatus" class="mb-3">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Connecting to camera...</p>
                </div>
                
                <div id="cameraContainer" style="display: none;">
                    <img id="liveVideo" 
                         src="" 
                         alt="Live Camera Feed" 
                         class="img-fluid border rounded"
                         style="max-width: 100%; height: auto; background: #000; min-height: 480px;">
                    
                    <div class="alert alert-info mt-2" id="streamInfo">
                        <i class="fas fa-info-circle me-2"></i>
                        <small>Stream URL: /api/camera/stream</small>
                    </div>
                    
                    <div class="mt-3">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h6 class="card-title">
                                            <i class="fas fa-door-open"></i> Door Status
                                        </h6>
                                        <span id="modalDoorStatus" class="badge bg-secondary">Checking...</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h6 class="card-title">
                                            <i class="fas fa-exclamation-triangle"></i> Alarm Status
                                        </h6>
                                        <span id="modalAlarmStatus" class="badge bg-secondary">Checking...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="cameraError" style="display: none;" class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Camera Unavailable</strong><br>
                    The camera system is currently not available. Please check the camera connection.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="stopLiveCamera()">
                    <i class="fas fa-stop"></i> Stop Feed
                </button>
                <button type="button" class="btn btn-primary" onclick="takeSnapshot()">
                    <i class="fas fa-camera"></i> Take Snapshot
                </button>
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<style>
/* ========================================
   INDUSTRIAL-GRADE PROFESSIONAL DESIGN SYSTEM
   Enterprise SCADA Inspired: Siemens WinCC, Ignition, Honeywell Experion
   Minimal ‚Ä¢ Dark ‚Ä¢ Elegant
   ======================================== */

/* Import Professional Typography */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap');

:root {
    /* Matte Industrial Colors - Reduced saturation by 15-20% */
    --primary-gradient: linear-gradient(135deg, #4a5f8a 0%, #5a4266 100%);
    --secondary-gradient: linear-gradient(135deg, #b07a9e 0%, #b84d5c 100%);
    --accent-gradient: linear-gradient(135deg, #3d8fb8 0%, #00b8c4 100%);
    
    /* Industrial Accent Colors */
    --accent-teal: #00d4aa;
    --accent-cyan: #00b8d4;
    --accent-lime: #76ff03;
    --accent-amber: #ffab00;
    --accent-red: #ff3d00;
    
    /* Muted Gray-Blue Background */
    --bg-primary: #0d1117;
    --bg-secondary: #161b22;
    --bg-tertiary: #1f2937;
    --bg-inactive: #374151;
    
    /* Professional Shadows */
    --shadow-card: 0 6px 12px rgba(0, 0, 0, 0.25);
    --shadow-elevated: 0 12px 24px rgba(0, 0, 0, 0.3);
    --shadow-glow: 0 0 20px rgba(0, 212, 170, 0.15);
    
    /* Typography Scale */
    --font-family: 'Inter', 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
    --font-section-title: 20px;
    --font-card-title: 15px;
    --font-value: 24px;
    --font-label: 12px;
    
    /* Spacing System (16-24px) */
    --spacing-xs: 8px;
    --spacing-sm: 16px;
    --spacing-md: 20px;
    --spacing-lg: 24px;
    --spacing-xl: 32px;
    
    /* Border Radius */
    --radius-card: 10px;
    --radius-button: 6px;
    --radius-badge: 4px;
}

* {
    font-family: var(--font-family);
}

.dashboard-container {
    min-height: 100vh;
    padding: 0;
    background: linear-gradient(180deg, var(--bg-primary) 0%, #0a0e14 100%);
}

/* ========================================
   SYSTEM INFO BAR - Top Status Strip
   ======================================== */

.system-info-bar {
    display: flex;
    align-items: center;
    gap: var(--spacing-lg);
    padding: var(--spacing-sm) var(--spacing-lg);
    background: var(--bg-secondary);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    font-size: var(--font-label);
    color: #9ca3af;
}

.info-section {
    display: flex;
    align-items: center;
    gap: 8px;
}

.info-section i {
    font-size: 14px;
    color: var(--accent-teal);
}

.info-label {
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.7;
}

.info-value {
    font-weight: 600;
    color: #e5e7eb;
    font-family: 'Courier New', monospace;
}

.btn-system-refresh {
    padding: 6px 16px;
    background: rgba(0, 212, 170, 0.1);
    border: 1px solid rgba(0, 212, 170, 0.3);
    color: var(--accent-teal);
    border-radius: var(--radius-button);
    font-weight: 600;
    font-size: 11px;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
}

.btn-system-refresh:hover {
    background: rgba(0, 212, 170, 0.2);
    border-color: var(--accent-teal);
    transform: translateY(-1px);
}

/* Connection Status Indicator */
.connection-status {
    display: flex;
    align-items: center;
    gap: 6px;
}

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    position: relative;
    will-change: opacity;
}

/* Only animate when online for better performance */
.status-online .status-dot {
    animation: statusPulse 3s ease-in-out infinite;
}

.status-dot::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    border-radius: 50%;
    opacity: 0.3;
    display: none; /* Disable ripple for performance */
}

@keyframes statusPulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.8;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    .status-dot {
        animation: none !important;
    }
}

.status-online {
    background: #10b981;
    box-shadow: 0 0 8px #10b981;
}

.status-online::before {
    background: #10b981;
}

.status-reconnecting {
    background: #f59e0b;
    box-shadow: 0 0 8px #f59e0b;
}

.status-reconnecting::before {
    background: #f59e0b;
}

.status-offline {
    background: #ef4444;
    box-shadow: 0 0 8px #ef4444;
    animation: none;
}

.status-offline::before {
    display: none;
}

.status-text {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* ========================================
   SECTION HEADERS - Visual Hierarchy
   ======================================== */

.section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-lg);
    margin: var(--spacing-md) 0;
    background: linear-gradient(90deg, rgba(74, 95, 138, 0.1) 0%, transparent 100%);
    border-left: 3px solid var(--accent-teal);
}

.section-title-wrapper {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.section-icon-badge {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--accent-teal), var(--accent-cyan));
    border-radius: var(--radius-card);
    box-shadow: var(--shadow-card);
}

.section-icon-badge i {
    font-size: 22px;
    color: #000;
}

.section-title {
    font-size: var(--font-section-title);
    font-weight: 700;
    color: #f9fafb;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.section-subtitle {
    font-size: 13px;
    color: #9ca3af;
    margin: 4px 0 0 0;
    font-weight: 400;
}

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgba(0, 212, 170, 0.1);
    border: 1px solid rgba(0, 212, 170, 0.3);
    border-radius: var(--radius-badge);
    font-size: var(--font-label);
    font-weight: 600;
    color: var(--accent-teal);
}

.status-badge i {
    font-size: 14px;
}

.badge-count {
    padding: 2px 8px;
    background: rgba(0, 212, 170, 0.2);
    border-radius: 10px;
    font-family: 'Courier New', monospace;
}

.badge-link {
    color: var(--accent-teal);
    opacity: 0.7;
    transition: opacity 0.2s;
}

.badge-link:hover {
    opacity: 1;
}

/* ========================================
   QUICK STATS BAR - Key Metrics Overview
   ======================================== */

.quick-stats-bar {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin: var(--spacing-md) var(--spacing-lg);
    padding: var(--spacing-md);
    background: var(--bg-secondary);
    border-radius: var(--radius-card);
    border: 1px solid rgba(255, 255, 255, 0.06);
}

.stat-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm);
    border-right: 1px solid rgba(255, 255, 255, 0.06);
}

.stat-item:last-child {
    border-right: none;
}

.stat-item i {
    font-size: 28px;
    color: var(--accent-teal);
    opacity: 0.8;
}

.stat-content {
    display: flex;
    flex-direction: column;
}

.stat-label {
    font-size: 11px;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 500;
}

.stat-value {
    font-size: 18px;
    font-weight: 600;
    color: #f9fafb;
    font-family: 'Courier New', monospace;
}

.status-badge-group {
    display: flex;
    gap: var(--spacing-sm);
    align-items: center;
}

.status-badge.system-operational {
    background: rgba(16, 185, 129, 0.1);
    border-color: rgba(16, 185, 129, 0.3);
    color: #10b981;
}

.status-badge.system-warning {
    background: rgba(245, 158, 11, 0.1);
    border-color: rgba(245, 158, 11, 0.3);
    color: #f59e0b;
}

.status-badge.system-alert {
    background: rgba(239, 68, 68, 0.1);
    border-color: rgba(239, 68, 68, 0.3);
    color: #ef4444;
    animation: alertPulse 1.5s ease-in-out infinite;
}

@keyframes alertPulse {
    0%, 100% {
        border-color: rgba(239, 68, 68, 0.3);
    }
    50% {
        border-color: rgba(239, 68, 68, 0.6);
    }
}

/* ========================================
   HELP ICONS & TOOLTIPS
   ======================================== */

.help-icon-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 24px;
    height: 24px;
    background: rgba(0, 212, 170, 0.1);
    border: 1px solid rgba(0, 212, 170, 0.3);
    border-radius: 50%;
    color: var(--accent-teal);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.6;
}

.help-icon-btn:hover {
    opacity: 1;
    background: rgba(0, 212, 170, 0.2);
    transform: scale(1.1);
}

.help-icon-btn:focus {
    outline: 2px solid var(--accent-teal);
    outline-offset: 2px;
}

/* ========================================
   LOADING STATES & SKELETONS
   ======================================== */

.skeleton-loader {
    background: linear-gradient(90deg, 
        rgba(255, 255, 255, 0.05) 25%, 
        rgba(255, 255, 255, 0.1) 50%, 
        rgba(255, 255, 255, 0.05) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: var(--radius-card);
}

/* Disable shimmer animation for performance */
@keyframes shimmer {
    0%, 100% { opacity: 1; }
}

@media (prefers-reduced-motion: reduce) {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

.skeleton-card {
    height: 200px;
    margin-bottom: var(--spacing-md);
}

.skeleton-text {
    height: 16px;
    margin-bottom: 8px;
    width: 80%;
}

.skeleton-value {
    height: 32px;
    width: 60%;
    margin-top: var(--spacing-sm);
}

/* Loading Spinner */
.loading-spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(0, 212, 170, 0.3);
    border-top-color: var(--accent-teal);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.btn-loading {
    position: relative;
    pointer-events: none;
    opacity: 0.7;
}

.btn-loading::after {
    content: '';
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    width: 14px;
    height: 14px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top-color: #fff;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

/* Connection Status Indicator */
.connection-status {
    position: fixed;
    top: 60px;
    right: 20px;
    padding: 8px 16px;
    background: var(--bg-secondary);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-badge);
    font-size: 12px;
    z-index: 1000;
    display: none;
    align-items: center;
    gap: 8px;
    box-shadow: var(--shadow-card);
}

.connection-status.offline {
    display: flex;
    background: rgba(239, 68, 68, 0.1);
    border-color: rgba(239, 68, 68, 0.3);
    color: #ef4444;
}

.connection-status.reconnecting {
    display: flex;
    background: rgba(251, 191, 36, 0.1);
    border-color: rgba(251, 191, 36, 0.3);
    color: #fbbf24;
}

.connection-status .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    animation: statusPulse 1.5s ease-in-out infinite;
}

/* Error State Display */
.error-message-card {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: var(--radius-card);
    padding: var(--spacing-md);
    margin: var(--spacing-md) var(--spacing-lg);
    display: none;
}

.error-message-card.show {
    display: block;
}

.error-message-card .error-icon {
    color: #ef4444;
    font-size: 24px;
    margin-right: var(--spacing-sm);
}

.error-message-card .retry-btn {
    margin-top: var(--spacing-sm);
    padding: 8px 16px;
    background: rgba(239, 68, 68, 0.2);
    border: 1px solid rgba(239, 68, 68, 0.4);
    color: #ef4444;
    border-radius: var(--radius-button);
    cursor: pointer;
    transition: all 0.2s;
}

.error-message-card .retry-btn:hover {
    background: rgba(239, 68, 68, 0.3);
}

/* ========================================
   HERO SECTION - Minimal Industrial Design
   ======================================== */

.hero-section {
    position: relative;
    min-height: 400px;
    margin: var(--spacing-md) var(--spacing-lg);
    border-radius: var(--radius-card);
    overflow: hidden;
    background: var(--bg-secondary);
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: var(--shadow-card);
}

.hero-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
                rgba(74, 95, 138, 0.05) 0%, 
                rgba(90, 66, 102, 0.03) 100%);
    opacity: 0.5;
}

.hero-content {
    position: relative;
    z-index: 2;
    padding: var(--spacing-xl);
}

.blob-3 {
    width: 300px;
    height: 300px;
    bottom: -100px;
    left: 30%;
    background: radial-gradient(circle, #f093fb 0%, transparent 70%);
    animation-delay: -10s;
}

.blob-4 {
    width: 450px;
    height: 450px;
    top: 20%;
    left: 40%;
    background: radial-gradient(circle, #4facfe 0%, transparent 70%);
    animation-delay: -15s;
}

@keyframes blobFloat {
    0%, 100% { transform: translate(0, 0) scale(1); }
    50% { transform: translate(15px, -25px) scale(1.05); }
}

/* Disable blob animations for better performance */
.blob {
    animation: none !important;
    opacity: 0.3 !important;
}

@media (prefers-reduced-motion: reduce) {
    .blob {
        display: none !important;
    }
}

/* Glass Panel (Singapore Modern) */
.glass-panel {
    position: relative;
    z-index: 10;
    padding: 4rem 2rem;
    text-align: center;
}

/* 3D Isometric Logo */
.iso-logo-container {
    display: flex;
    justify-content: center;
    margin-bottom: 2rem;
    perspective: 1000px;
}

.iso-logo {
    width: 120px;
    height: 120px;
    position: relative;
    transform-style: preserve-3d;
    animation: isoRotate 10s ease-in-out infinite;
}

.iso-face {
    position: absolute;
    width: 100%;
    height: 100%;
    background: var(--primary-gradient);
    border: 2px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
}

.iso-top {
    transform: rotateX(60deg) translateZ(60px);
    background: linear-gradient(135deg, #667eea 0%, #9ab8ff 100%);
}

.iso-left {
    transform: rotateY(-30deg) rotateX(30deg) translateZ(30px);
}

.iso-right {
    transform: rotateY(30deg) rotateX(30deg) translateZ(30px);
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
}

@keyframes isoRotate {
    0%, 100% { transform: rotateX(0deg) rotateY(0deg); }
    50% { transform: rotateX(10deg) rotateY(180deg); }
}

/* Simplify 3D animations for performance */
.iso-logo {
    animation-duration: 20s !important; /* Slower = less CPU */
    will-change: transform;
}

@media (prefers-reduced-motion: reduce) {
    .iso-logo {
        animation: none !important;
        transform: none !important;
    }
}

/* Kinetic Typography (Chinese Dynamic) */
.kinetic-title {
    font-size: 4rem;
    font-weight: 900;
    letter-spacing: -2px;
    margin: 2rem 0;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1.5rem;
}

.title-word {
    display: inline-block;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
    animation: wordPulse 3s ease-in-out infinite;
}

.title-word:nth-child(1) { animation-delay: 0s; }
.title-word:nth-child(2) { animation-delay: 0.2s; }
.title-word:nth-child(3) { animation-delay: 0.4s; }

@keyframes wordPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
}

/* Disable glitch effect for performance */
@keyframes glitchText {
    0%, 100% { opacity: 1; }
}

.title-word {
    animation-duration: 4s !important; /* Slower animations */
    will-change: transform;
}

@media (prefers-reduced-motion: reduce) {
    .title-word {
        animation: none !important;
    }
}ccent-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    opacity: 0;
    animation: glitchText 5s ease-in-out infinite;
}

@keyframes wordPulse {
    0%, 100% { transform: scale(1); filter: brightness(1); }
    50% { transform: scale(1.05); filter: brightness(1.2); }
}

@keyframes glitchText {
    0%, 90%, 100% { opacity: 0; transform: translateX(0); }
    92%, 98% { opacity: 0.8; transform: translateX(2px); }
    94%, 96% { opacity: 0.8; transform: translateX(-2px); }
}

/* Status Stream (US Tech) */
.status-stream {
    display: flex;
    justify-content: center;
    gap: 2rem;
    flex-wrap: wrap;
    margin-top: 2rem;
}

.stream-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 50px;
    backdrop-filter: blur(10px);
    font-size: 0.9rem;
    font-weight: 600;
    color: #fff;
    transition: all 0.3s ease;
    animation: streamSlide 2s ease-in-out infinite;
}

.stream-item:nth-child(1) { animation-delay: 0s; }
.stream-item:nth-child(2) { animation-delay: 0.3s; }
.stream-item:nth-child(3) { animation-delay: 0.6s; }

.stream-item:hover {
    background: rgba(102, 126, 234, 0.2);
    border-color: rgba(102, 126, 234, 0.5);
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
}

.stream-item i {
    color: #667eea;
    font-size: 1.2rem;
}

@keyframes streamSlide {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(5px); }
}

/* Quantum Visualization Canvas */
.quantum-viz {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    opacity: 0.3;
    pointer-events: none;
}

#quantumCanvas {
    width: 100%;
    height: 100%;
}

/* ========================================
   NEOMORPHIC STATUS GRID (European Design)
   ======================================== */

.neo-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--spacing-lg);
    padding: var(--spacing-lg);
}

/* Industrial Card Design */
.neo-card {
    position: relative;
    background: var(--bg-secondary);
    border-radius: var(--radius-card);
    padding: var(--spacing-lg);
    box-shadow: var(--shadow-card);
    border: 1px solid rgba(255, 255, 255, 0.08);
    transition: all 0.3s ease-in-out;
    overflow: hidden;
}

.neo-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 3px;
    background: linear-gradient(90deg, var(--accent-teal), var(--accent-cyan));
    opacity: 0.3;
    transition: opacity 0.3s ease;
}

.neo-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-elevated), var(--shadow-glow);
    border-color: rgba(0, 212, 170, 0.2);
}

.neo-card:hover::before {
    opacity: 1;
}

.neo-glow {
    display: none; /* Remove heavy animation for industrial look */
}

.card-icon-wrapper {
    margin-bottom: var(--spacing-md);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.icon-orbit {
    width: 48px;
    height: 48px;
    border-radius: 8px;
    background: linear-gradient(135deg, var(--accent-teal), var(--accent-cyan));
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-shadow: 0 4px 12px rgba(0, 212, 170, 0.2);
}

.icon-orbit i {
    font-size: 22px;
    color: #000;
    z-index: 2;
}

.icon-orbit::before {
    display: none; /* Remove orbit animation */
}

.card-label {
    font-size: var(--font-label);
    color: #9ca3af;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 500;
    margin-bottom: 8px;
}

.card-value {
    font-size: var(--font-value);
    font-weight: 600;
    color: #f9fafb;
    margin-bottom: var(--spacing-sm);
    font-family: 'Courier New', monospace;
}

/* Status Indicators */
.card-indicator {
    position: absolute;
    top: var(--spacing-sm);
    right: var(--spacing-sm);
    width: 12px;
    height: 12px;
    border-radius: 50%;
    box-shadow: 0 0 8px currentColor;
}

.card-indicator.safe {
    background: #10b981;
    color: #10b981;
}

.card-indicator.alert {
    background: var(--accent-red);
    color: var(--accent-red);
    animation: statusPulse 1.5s ease-in-out infinite;
}

.card-indicator.info {
    background: var(--accent-cyan);
    color: var(--accent-cyan);
}

.card-indicator.warning {
    background: var(--accent-amber);
    color: var(--accent-amber);
}

.card-indicator.offline {
    background: #6b7280;
    color: #6b7280;
}

@keyframes statusPulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.6; transform: scale(1.1); }
}
    50% { opacity: 1; transform: scaleX(1); }
}

/* ========================================
   AI INTELLIGENCE CENTER
   ======================================== */

.ai-intelligence-panel {
    background: linear-gradient(145deg, #1a1a2e 0%, #16213e 100%);
    border-radius: 32px;
    padding: 3rem;
    margin: 1rem;
    position: relative;
    overflow: hidden;
    border: 2px solid rgba(102, 126, 234, 0.3);
    box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5),
                0 0 60px rgba(102, 126, 234, 0.2);
}

.ai-brain-bg {
    position: absolute;
    top: -100px;
    right: -100px;
    width: 400px;
    height: 400px;
    opacity: 0.1;
    pointer-events: none;
}

.brain-pulse {
    position: absolute;
    width: 200px;
    height: 200px;
    border-radius: 50%;
    border: 2px solid #667eea;
    animation: brainPulse 4s ease-in-out infinite;
}

.brain-pulse:nth-child(2) {
    animation-delay: 1.3s;
    border-color: #764ba2;
}

.brain-pulse:nth-child(3) {
    animation-delay: 2.6s;
    border-color: #f093fb;
}

@keyframes brainPulse {
    0% {
        transform: scale(0.5);
        opacity: 0;
    }
    50% {
        opacity: 0.3;
    }
    100% {
        transform: scale(2);
        opacity: 0;
    }
}

.ai-header {
    display: flex;
    align-items: center;
    gap: 2rem;
    margin-bottom: 3rem;
    flex-wrap: wrap;
}

.ai-logo {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    color: #fff;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
    animation: aiPulse 2s ease-in-out infinite;
}

@keyframes aiPulse {
    0%, 100% { transform: scale(1); box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5); }
    50% { transform: scale(1.05); box-shadow: 0 15px 40px rgba(102, 126, 234, 0.8); }
}

.ai-title-section {
    flex: 1;
}

.ai-main-title {
    font-size: 2.5rem;
    font-weight: 900;
    color: #fff;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 1rem;
    letter-spacing: 2px;
}

.ai-badge {
    display: inline-block;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 0.3rem 1rem;
    border-radius: 8px;
    font-size: 1.5rem;
    font-weight: 900;
    letter-spacing: 3px;
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.ai-subtitle {
    color: rgba(255, 255, 255, 0.7);
    font-size: 1rem;
    margin: 0.5rem 0 0 0;
    font-weight: 400;
}

.ai-status-badge {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background: rgba(38, 222, 129, 0.1);
    border: 2px solid #26de81;
    padding: 0.75rem 1.5rem;
    border-radius: 50px;
    font-weight: 700;
    color: #26de81;
    font-size: 1.1rem;
    letter-spacing: 2px;
}

.status-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #26de81;
}

.status-dot.pulsing {
    animation: dotPulse 1.5s ease-in-out infinite;
}

@keyframes dotPulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.3); opacity: 0.7; }
}

/* AI Metrics Grid */
.ai-metrics-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.ai-metric-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 2rem;
    display: flex;
    gap: 1.5rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.ai-metric-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
    transition: left 0.5s ease;
}

.ai-metric-card:hover::before {
    left: 100%;
}

.ai-metric-card:hover {
    transform: translateY(-5px);
    border-color: rgba(102, 126, 234, 0.5);
    box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
}

.ai-metric-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    color: #fff;
    flex-shrink: 0;
}

.ai-metric-icon.threat-icon {
    background: linear-gradient(135deg, #26de81 0%, #20bf6b 100%);
}

.ai-metric-content {
    flex: 1;
}

.ai-metric-label {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.6);
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.ai-metric-value {
    font-size: 3rem;
    font-weight: 900;
    color: #fff;
    line-height: 1;
    margin-bottom: 1rem;
}

.ai-metric-unit {
    font-size: 1.5rem;
    color: rgba(255, 255, 255, 0.7);
}

.threat-display {
    font-size: 2rem;
    padding: 0.5rem 1rem;
    border-radius: 12px;
    display: inline-block;
    font-weight: 900;
    letter-spacing: 2px;
}

/* Industrial Progress Bars */
.ai-progress-bar {
    height: 6px;
    background: rgba(255, 255, 255, 0.08);
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 0.75rem;
}

.ai-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-teal), var(--accent-cyan));
    border-radius: 3px;
    transition: width 0.3s ease-in-out;
    box-shadow: 0 0 8px rgba(0, 212, 170, 0.3);
}

.threat-indicator-bar {
    display: flex;
    gap: 4px;
    margin-bottom: 0.75rem;
}

.threat-segment {
    flex: 1;
    height: 6px;
    border-radius: 3px;
    opacity: 0.3;
    transition: all 0.3s ease-in-out;
}

.threat-segment.low {
    background: #10b981;
}

.threat-segment.medium {
    background: var(--accent-amber);
}

.threat-segment.high {
    background: #f97316;
}

.threat-segment.critical {
    background: var(--accent-red);
}

.threat-segment.active {
    opacity: 1;
    box-shadow: 0 0 10px currentColor;
}

.ai-counter-animation {
    display: flex;
    gap: 8px;
    margin-bottom: 0.75rem;
}

.counter-bar {
    flex: 1;
    height: 6px;
    background: rgba(102, 126, 234, 0.3);
    border-radius: 3px;
    animation: counterPulse 1.5s ease-in-out infinite;
}

.counter-bar:nth-child(2) {
    animation-delay: 0.3s;
}

.counter-bar:nth-child(3) {
    animation-delay: 0.6s;
}

@keyframes counterPulse {
    0%, 100% { background: rgba(102, 126, 234, 0.3); }
    50% { background: rgba(102, 126, 234, 0.8); }
}

.pattern-visualization {
    display: flex;
    gap: 10px;
    margin-bottom: 0.75rem;
}

.pattern-node {
    width: 12px;
    height: 12px;
    background: #667eea;
    border-radius: 50%;
    animation: nodeGlow 2s ease-in-out infinite;
}

.pattern-node:nth-child(2) { animation-delay: 0.5s; }
.pattern-node:nth-child(3) { animation-delay: 1s; }
.pattern-node:nth-child(4) { animation-delay: 1.5s; }

@keyframes nodeGlow {
    0%, 100% { box-shadow: 0 0 5px #667eea; transform: scale(1); }
    50% { box-shadow: 0 0 15px #667eea; transform: scale(1.3); }
}

/* Security Score Bar */
.security-score-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 0.75rem;
}

.score-fill {
    height: 100%;
    background: linear-gradient(90deg, #f5576c, #f093fb, #4facfe);
    border-radius: 10px;
    transition: width 0.5s ease, background 0.5s ease;
}

.score-suffix {
    font-size: 1.5rem;
    color: rgba(255, 255, 255, 0.5);
    margin-left: 5px;
}

/* Incidents Visualization */
.incidents-visualization {
    display: flex;
    gap: 12px;
    margin-bottom: 0.75rem;
    justify-content: center;
}

.incident-icon {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #f5576c;
    font-size: 18px;
    animation: incidentPulse 2s ease-in-out infinite;
}

.incident-icon:nth-child(2) { animation-delay: 0.3s; }
.incident-icon:nth-child(3) { animation-delay: 0.6s; }

@keyframes incidentPulse {
    0%, 100% { transform: scale(1); opacity: 0.7; }
    50% { transform: scale(1.2); opacity: 1; }
}

.ai-metric-info {
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.5);
    font-style: italic;
}

/* AI Activity Feed */
.ai-activity-section {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.ai-section-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #fff;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.ai-section-title i {
    color: #667eea;
}

.ai-activity-feed {
    max-height: 300px;
    overflow-y: auto;
}

.ai-activity-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.02);
    border-left: 3px solid #667eea;
    margin-bottom: 0.75rem;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.ai-activity-item:hover {
    background: rgba(102, 126, 234, 0.1);
    transform: translateX(5px);
}

.activity-time {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.5);
    min-width: 80px;
}

.activity-icon {
    width: 36px;
    height: 36px;
    background: rgba(102, 126, 234, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #667eea;
}

.activity-text {
    flex: 1;
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.95rem;
}

/* Security Alerts Styling */
.security-alerts-feed {
    max-height: 350px;
    overflow-y: auto;
}

.security-alert-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.5rem;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    margin-bottom: 1rem;
    border-left: 4px solid #667eea;
    transition: all 0.3s ease;
}

.security-alert-item.no-alerts {
    border-left-color: #26de81;
    background: rgba(38, 222, 129, 0.05);
}

.security-alert-item.warning {
    border-left-color: #f7b731;
    background: rgba(247, 183, 49, 0.05);
}

.security-alert-item.critical {
    border-left-color: #fc5c65;
    background: rgba(252, 92, 101, 0.05);
    animation: alertPulse 2s ease-in-out infinite;
}

.security-alert-item:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateX(5px);
}

.alert-icon {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    font-size: 24px;
    flex-shrink: 0;
}

.no-alerts .alert-icon {
    background: rgba(38, 222, 129, 0.2);
    color: #26de81;
}

.warning .alert-icon {
    background: rgba(247, 183, 49, 0.2);
    color: #f7b731;
}

.critical .alert-icon {
    background: rgba(252, 92, 101, 0.2);
    color: #fc5c65;
}

.alert-text {
    flex: 1;
    color: rgba(255, 255, 255, 0.95);
    font-size: 1.05rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.alert-subtext {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.9rem;
    margin-top: 0.25rem;
}

.alert-time {
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.85rem;
    margin-top: 0.5rem;
}

@keyframes alertPulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(252, 92, 101, 0.4); }
    50% { box-shadow: 0 0 0 10px rgba(252, 92, 101, 0); }
}

/* AI Capabilities */
.ai-capabilities {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.capability-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: rgba(102, 126, 234, 0.1);
    border: 1px solid rgba(102, 126, 234, 0.3);
    border-radius: 50px;
    color: #fff;
    font-size: 0.9rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

.capability-badge:hover {
    background: rgba(102, 126, 234, 0.2);
    border-color: #667eea;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
}

.capability-badge i {
    color: #667eea;
}

.card-action {
    margin-top: 1rem;
}

.neo-btn {
    position: relative;
    width: 100%;
    padding: 1rem;
    border: none;
    border-radius: 16px;
    background: transparent;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-bg {
    position: absolute;
    inset: 0;
    background: var(--primary-gradient);
    transition: all 0.3s ease;
}

.btn-text {
    position: relative;
    z-index: 2;
    color: #fff;
    font-weight: 700;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.neo-btn:hover .btn-bg {
    transform: scale(1.05);
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
}

.neo-btn:active {
    transform: scale(0.95);
}

/* ========================================
   FLUID ANALYTICS CARD (Scandinavian Minimalism)
   ======================================== */

.fluid-card {
    background: linear-gradient(145deg, #1e1e30, #25253a);
    border-radius: 32px;
    padding: 0;
    margin: 1rem;
    box-shadow: var(--shadow-lg);
    border: 1px solid rgba(255, 255, 255, 0.1);
    overflow: hidden;
    position: relative;
}

.wave-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 120px;
    overflow: hidden;
    z-index: 0;
}

.wave {
    width: 100%;
    height: 100%;
}

.wave-path {
    animation: waveMove 8s ease-in-out infinite;
}

@keyframes waveMove {
    0%, 100% { d: path("M0,50 Q300,0 600,50 T1200,50 L1200,100 L0,100 Z"); }
    50% { d: path("M0,50 Q300,100 600,50 T1200,50 L1200,100 L0,100 Z"); }
}

.fluid-card .card-header {
    position: relative;
    z-index: 10;
    padding: 3rem 2rem 2rem;
    border-bottom: none;
    background: transparent;
}

.header-accent {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: var(--primary-gradient);
}

.fluid-title {
    font-size: 1.8rem;
    font-weight: 900;
    color: #fff;
    letter-spacing: 1px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
}

.live-pulse {
    font-size: 0.85rem;
    color: #26de81;
    animation: livePulse 2s ease-in-out infinite;
}

@keyframes livePulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
}

/* Responsive Design */
@media (max-width: 768px) {
    .kinetic-title {
        font-size: 2.5rem;
    }
    
    .neo-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .stream-item {
        font-size: 0.8rem;
        padding: 0.6rem 1.2rem;
    }
}

/* Hexagonal Security Pattern */
.hex-pattern {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 1;
}

.hex-item {
    position: absolute;
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, rgba(0, 255, 157, 0.1), rgba(0, 212, 255, 0.1));
    clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
    border: 1px solid rgba(0, 255, 157, 0.3);
    animation: hexPulse 4s ease-in-out infinite;
}

.hex-item:nth-child(1) { animation-delay: 0s; }
.hex-item:nth-child(2) { animation-delay: 0.5s; }
.hex-item:nth-child(3) { animation-delay: 1s; }
.hex-item:nth-child(4) { animation-delay: 1.5s; }
.hex-item:nth-child(5) { animation-delay: 2s; }
.hex-item:nth-child(6) { animation-delay: 2.5s; }

@keyframes hexPulse {
    0%, 100% {
        opacity: 0.3;
        transform: scale(1) rotate(0deg);
    }
    50% {
        opacity: 0.8;
        transform: scale(1.2) rotate(180deg);
        box-shadow: 0 0 20px rgba(0, 255, 157, 0.4);
    }
}

/* Digital Code Rain Effect */
.code-rain {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow: hidden;
    pointer-events: none;
    opacity: 0.4;
    z-index: 1;
}

.code-column {
    position: absolute;
    top: -100%;
    width: 20px;
    height: 100px;
    background: linear-gradient(
        to bottom,
        transparent 0%,
        rgba(0, 255, 157, 0.8) 50%,
        transparent 100%
    );
    animation: codeRain 10s linear infinite;
    font-family: 'Courier New', monospace;
    font-size: 10px;
    color: rgba(0, 255, 157, 0.6);
    text-shadow: 0 0 5px rgba(0, 255, 157, 0.8);
}

.code-column::before {
    content: '01';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: digitChange 0.5s steps(2) infinite;
}

@keyframes codeRain {
    0% {
        top: -100%;
        opacity: 0;
    }
    10% {
        opacity: 1;
    }
    90% {
        opacity: 1;
    }
    100% {
        top: 100%;
        opacity: 0;
    }
}

@keyframes digitChange {
    0% { content: '01'; }
    25% { content: '10'; }
    50% { content: '11'; }
    75% { content: '00'; }
    100% { content: '01'; }
}

/* Blockchain Cubes Background */
.blockchain-cubes {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    perspective: 1000px;
    overflow: hidden;
    z-index: 1;
    pointer-events: none;
}

.cube {
    position: absolute;
    width: 80px;
    height: 80px;
    transform-style: preserve-3d;
    animation: rotateCube 20s linear infinite;
}

.cube::before,
.cube::after {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
        rgba(0, 255, 157, 0.1) 0%, 
        rgba(0, 212, 255, 0.15) 100%);
    border: 1px solid rgba(0, 255, 157, 0.3);
    box-shadow: 0 0 20px rgba(0, 255, 157, 0.2),
                inset 0 0 20px rgba(0, 212, 255, 0.1);
}

.cube::before {
    transform: rotateY(0deg) translateZ(40px);
}

.cube::after {
    transform: rotateY(90deg) translateZ(40px);
}

.cube-1 {
    top: 10%;
    left: 5%;
    animation-delay: 0s;
    animation-duration: 25s;
}

.cube-2 {
    top: 60%;
    left: 15%;
    animation-delay: -5s;
    animation-duration: 30s;
}

.cube-3 {
    top: 30%;
    right: 10%;
    animation-delay: -10s;
    animation-duration: 28s;
}

.cube-4 {
    top: 70%;
    right: 20%;
    animation-delay: -15s;
    animation-duration: 22s;
}

.cube-5 {
    top: 45%;
    left: 50%;
    animation-delay: -8s;
    animation-duration: 26s;
    opacity: 0.6;
}

@keyframes rotateCube {
    0% {
        transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);
    }
    100% {
        transform: rotateX(360deg) rotateY(360deg) rotateZ(360deg);
    }
}

/* AI Neural Network */
.ai-network {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow: hidden;
    z-index: 1;
    pointer-events: none;
    opacity: 0.4;
}

.network-svg {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
}

.ai-line {
    stroke-dasharray: 1000;
    stroke-dashoffset: 1000;
    animation: drawLine 8s ease-in-out infinite;
}

.ai-line:nth-child(2) {
    animation-delay: 1s;
}

.ai-line:nth-child(3) {
    animation-delay: 2s;
}

@keyframes drawLine {
    0%, 100% {
        stroke-dashoffset: 1000;
        opacity: 0;
    }
    20%, 80% {
        stroke-dashoffset: 0;
        opacity: 1;
    }
}

.ai-node {
    animation: nodePulse 2s ease-in-out infinite;
    filter: drop-shadow(0 0 6px currentColor);
}

.ai-node:nth-child(even) {
    animation-delay: 1s;
}

@keyframes nodePulse {
    0%, 100% {
        r: 4;
        opacity: 0.6;
    }
    50% {
        r: 6;
        opacity: 1;
    }
}

/* Security Frame - Corner Brackets */
.security-frame {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 3;
}

.corner-bracket {
    position: absolute;
    width: 60px;
    height: 60px;
    border: 2px solid rgba(0, 255, 157, 0.6);
    box-shadow: 0 0 15px rgba(0, 255, 157, 0.3);
    animation: bracketPulse 2s ease-in-out infinite;
}

.corner-bracket.top-left {
    top: 20px;
    left: 20px;
    border-right: none;
    border-bottom: none;
    border-top-left-radius: 5px;
}

.corner-bracket.top-right {
    top: 20px;
    right: 20px;
    border-left: none;
    border-bottom: none;
    border-top-right-radius: 5px;
    animation-delay: 0.5s;
}

.corner-bracket.bottom-left {
    bottom: 20px;
    left: 20px;
    border-right: none;
    border-top: none;
    border-bottom-left-radius: 5px;
    animation-delay: 1s;
}

.corner-bracket.bottom-right {
    bottom: 20px;
    right: 20px;
    border-left: none;
    border-top: none;
    border-bottom-right-radius: 5px;
    animation-delay: 1.5s;
}

@keyframes bracketPulse {
    0%, 100% {
        border-color: rgba(0, 255, 157, 0.4);
        box-shadow: 0 0 10px rgba(0, 255, 157, 0.2);
    }
    50% {
        border-color: rgba(0, 255, 157, 0.9);
        box-shadow: 0 0 25px rgba(0, 255, 157, 0.6);
    }
}

/* Hero Content - Higher Z-index */
.hero-content {
    position: relative;
    z-index: 2;
}

.system-logo {
    font-size: 5.5rem;
    background: linear-gradient(135deg, #00ff9d 0%, #00d4ff 50%, #00ff9d 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1.5rem;
    filter: drop-shadow(0 0 30px rgba(0, 255, 157, 0.5));
    animation: logoGlow 3s ease-in-out infinite;
    position: relative;
    z-index: 2;
}

@keyframes logoGlow {
    0%, 100% {
        filter: drop-shadow(0 0 20px rgba(0, 255, 157, 0.4));
        transform: scale(1);
    }
    50% {
        filter: drop-shadow(0 0 40px rgba(0, 255, 157, 0.8));
        transform: scale(1.05);
    }
}

.hero-title {
    font-size: 3.8rem;
    font-weight: 900;
    background: linear-gradient(135deg, #ffffff 0%, #00ff9d 50%, #00d4ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1rem;
    letter-spacing: 5px;
    text-shadow: 0 0 80px rgba(0, 255, 157, 0.3);
    position: relative;
    z-index: 2;
    animation: titlePulse 4s ease-in-out infinite;
}

@keyframes titlePulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.9; }
}

.hero-subtitle {
    font-size: 1.4rem;
    opacity: 0.9;
    margin-bottom: 2rem;
    color: rgba(255, 255, 255, 0.8);
    letter-spacing: 2px;
    text-transform: uppercase;
    font-weight: 500;
    position: relative;
    z-index: 2;
}

.status-indicator {
    display: inline-block;
    padding: 1rem 2rem;
    border-radius: 50px;
    font-weight: 700;
    font-size: 1.2rem;
    letter-spacing: 2px;
    animation: pulse 2s ease-in-out infinite;
}

.status-indicator.secure {
    background: var(--gradient-success);
    box-shadow: 0 0 30px rgba(16, 185, 129, 0.4);
}

.status-indicator.alert {
    background: var(--gradient-danger);
    box-shadow: 0 0 30px rgba(239, 68, 68, 0.4);
}

.status-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    padding: 0 1rem 2rem 1rem;
    margin-top: 0;
    position: relative;
    z-index: 10;
}

.status-panel {
    background: linear-gradient(135deg, 
                rgba(30, 41, 59, 0.9) 0%, 
                rgba(15, 23, 42, 0.95) 100%);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(0, 255, 157, 0.2);
    border-radius: 20px;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.status-panel::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #00ff9d 0%, #00d4ff 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.status-panel:hover::before {
    opacity: 1;
}

.status-panel:hover {
    transform: translateY(-12px) scale(1.02);
    box-shadow: 0 25px 50px rgba(0, 255, 157, 0.2),
                0 0 50px rgba(0, 212, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
    border-color: rgba(0, 255, 157, 0.5);
}

.panel-header {
    background: linear-gradient(135deg, 
                rgba(0, 255, 157, 0.1) 0%, 
                rgba(0, 212, 255, 0.05) 100%);
    padding: 1.5rem;
    display: flex;
    align-items: center;
    font-weight: 700;
    font-size: 0.85rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    border-bottom: 1px solid rgba(0, 255, 157, 0.1);
    position: relative;
}

.panel-header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 255, 157, 0.5) 50%, 
                transparent 100%);
}

.panel-header i {
    font-size: 1.8rem;
    margin-right: 1rem;
    background: linear-gradient(135deg, #00ff9d 0%, #00d4ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(0 0 10px rgba(0, 255, 157, 0.5));
    animation: iconGlow 2s ease-in-out infinite;
}

@keyframes iconGlow {
    0%, 100% { filter: drop-shadow(0 0 8px rgba(0, 255, 157, 0.4)); }
    50% { filter: drop-shadow(0 0 15px rgba(0, 255, 157, 0.7)); }
}

.panel-body {
    padding: 2.5rem 2rem;
    text-align: center;
}

.status-value {
    font-size: 3.2rem;
    font-weight: 900;
    background: linear-gradient(135deg, #ffffff 0%, #00ff9d 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1rem;
    filter: drop-shadow(0 2px 8px rgba(0, 255, 157, 0.3));
    line-height: 1.2;
}

.status-indicator-bar {
    height: 5px;
    border-radius: 10px;
    margin-top: 1.5rem;
    position: relative;
    overflow: hidden;
}

.status-indicator-bar::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.4) 50%, 
                transparent 100%);
    animation: shimmerBar 2s linear infinite;
}

@keyframes shimmerBar {
    0% { left: -100%; }
    100% { left: 100%; }
}

.status-indicator-bar.safe {
    background: linear-gradient(90deg, #10b981 0%, #00ff9d 100%);
    box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
}

.status-indicator-bar.warning {
    background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 100%);
    box-shadow: 0 0 15px rgba(245, 158, 11, 0.5);
}

.status-indicator-bar.danger {
    background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
    box-shadow: 0 0 15px rgba(239, 68, 68, 0.5);
}

.status-indicator-bar.info {
    background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
    box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
}

.status-indicator-bar.primary {
    background: var(--gradient-secondary);
}

.analytics-card, .control-center {
    background: linear-gradient(135deg, 
                rgba(10, 25, 47, 0.95) 0%, 
                rgba(20, 35, 60, 0.9) 50%, 
                rgba(10, 25, 47, 0.95) 100%);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(0, 255, 157, 0.2);
    border-radius: 24px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
    overflow: hidden;
    position: relative;
    margin: 0 1rem;
}

.card-header {
    background: linear-gradient(135deg, 
                rgba(0, 255, 157, 0.15) 0%, 
                rgba(0, 212, 255, 0.1) 100%);
    padding: 2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 2px solid rgba(0, 255, 157, 0.2);
    position: relative;
    z-index: 2;
}

.card-header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 255, 157, 0.8) 50%, 
                transparent 100%);
}

.section-icon {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, #00ff9d 0%, #00d4ff 100%);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: #0a1628;
    box-shadow: 0 0 20px rgba(0, 255, 157, 0.5);
    animation: iconGlow 2s ease-in-out infinite;
}

.card-header h3 {
    font-size: 1.8rem;
    font-weight: 900;
    margin: 0;
    letter-spacing: 3px;
    flex: 1;
    margin-left: 1.5rem;
    background: linear-gradient(135deg, #ffffff 0%, #00ff9d 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.status-badge {
    display: flex;
    align-items: center;
    padding: 0.5rem 1.2rem;
    background: rgba(0, 255, 157, 0.1);
    border: 1px solid rgba(0, 255, 157, 0.4);
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 1.5px;
    color: #00ff9d;
}

.pulse-dot {
    width: 8px;
    height: 8px;
    background: #00ff9d;
    border-radius: 50%;
    margin-right: 0.5rem;
    animation: pulseDot 1.5s ease-in-out infinite;
    box-shadow: 0 0 10px rgba(0, 255, 157, 0.8);
}

@keyframes pulseDot {
    0%, 100% {
        opacity: 1;
        transform: scale(1);
    }
    50% {
        opacity: 0.5;
        transform: scale(1.3);
    }
}

.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.5rem;
    padding: 2rem;
    position: relative;
    z-index: 2;
}

.metric-item {
    display: flex;
    align-items: center;
    background: linear-gradient(135deg, 
                rgba(30, 41, 59, 0.6) 0%, 
                rgba(15, 23, 42, 0.8) 100%);
    border: 1px solid rgba(0, 255, 157, 0.15);
    border-radius: 16px;
    padding: 1.5rem;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    overflow: hidden;
}

.metric-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 3px;
    height: 100%;
    background: linear-gradient(180deg, #00ff9d 0%, #00d4ff 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.metric-item:hover::before {
    opacity: 1;
}

.metric-item:hover {
    background: linear-gradient(135deg, 
                rgba(30, 41, 59, 0.8) 0%, 
                rgba(15, 23, 42, 0.95) 100%);
    transform: translateY(-5px) scale(1.02);
    border-color: rgba(0, 255, 157, 0.4);
    box-shadow: 0 10px 30px rgba(0, 255, 157, 0.2);
}

.metric-icon {
    width: 65px;
    height: 65px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    margin-right: 1.2rem;
    position: relative;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

.metric-icon::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    border-radius: 16px;
    transform: translate(-50%, -50%);
    background: inherit;
    filter: blur(10px);
    opacity: 0.5;
    z-index: -1;
}

.metric-icon.door-open {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
}

.metric-icon.door-close {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
}

.metric-icon.alarm {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
}

.metric-icon.uptime {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
}

.metric-value {
    font-size: 2.2rem;
    font-weight: 900;
    background: linear-gradient(135deg, #ffffff 0%, #00ff9d 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.2;
    filter: drop-shadow(0 2px 4px rgba(0, 255, 157, 0.3));
}
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.metric-label {
    font-size: 0.9rem;
    opacity: 0.8;
    font-weight: 500;
}

.metric-detail {
    font-size: 0.75rem;
    opacity: 0.6;
    margin-top: 0.25rem;
    font-style: italic;
}

.controls-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
    padding: 2rem;
    position: relative;
    z-index: 2;
}

.control-btn {
    background: linear-gradient(135deg, 
                rgba(30, 41, 59, 0.6) 0%, 
                rgba(15, 23, 42, 0.8) 100%);
    border: 2px solid rgba(0, 255, 157, 0.2);
    border-radius: 16px;
    padding: 2rem;
    color: #ffffff;
    text-align: center;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 160px;
    justify-content: center;
    position: relative;
    overflow: hidden;
}

.control-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #00ff9d 0%, #00d4ff 100%);
    transform: scaleX(0);
    transition: transform 0.4s ease;
}

.control-btn:hover::before {
    transform: scaleX(1);
}

.control-btn:hover {
    background: linear-gradient(135deg, 
                rgba(0, 255, 157, 0.15) 0%, 
                rgba(0, 212, 255, 0.1) 100%);
    border-color: rgba(0, 255, 157, 0.6);
    transform: translateY(-8px) scale(1.03);
    box-shadow: 0 15px 40px rgba(0, 255, 157, 0.3),
                0 0 30px rgba(0, 212, 255, 0.2);
}

.control-btn i {
    font-size: 3rem;
    margin-bottom: 1.2rem;
    background: linear-gradient(135deg, #00ff9d 0%, #00d4ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(0 0 10px rgba(0, 255, 157, 0.5));
    transition: all 0.3s ease;
}

.control-btn:hover i {
    transform: scale(1.15);
    filter: drop-shadow(0 0 20px rgba(0, 255, 157, 0.8));
}

.control-btn span {
    font-weight: 700;
    letter-spacing: 2px;
    font-size: 0.9rem;
    text-transform: uppercase;
    color: rgba(255, 255, 255, 0.9);
}



.live-indicator {
    display: flex;
    align-items: center;
    font-weight: 600;
    font-size: 0.9rem;
    letter-spacing: 1px;
}

.pulse-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--success-color);
    margin-right: 0.5rem;
    animation: pulse-dot 1s ease-in-out infinite;
}

@keyframes pulse-dot {
    0%, 100% { 
        transform: scale(1);
        opacity: 1;
    }
    50% { 
        transform: scale(1.2);
        opacity: 0.7;
    }
}





}

@media (max-width: 992px) {
    .controls-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
    }
}

@media (max-width: 768px) {
    .hero-title {
        font-size: 2.5rem;
    }
    
    .hero-subtitle {
        font-size: 1.1rem;
    }
    
    .status-grid {
        grid-template-columns: 1fr;
        padding: 1rem;
    }
    
    .metrics-grid {
        grid-template-columns: 1fr;
    }
    
    .controls-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        padding: 1rem;
    }
    
    .system-info-bar {
        flex-wrap: wrap;
        gap: var(--spacing-sm);
    }
    
    .section-header {
        flex-direction: column;
        align-items: flex-start;
    }
}

/* ========================================
   INDUSTRIAL FOOTER
   ======================================== */

.industrial-footer {
    background: var(--bg-secondary);
    border-top: 1px solid rgba(255, 255, 255, 0.06);
    padding: var(--spacing-md) var(--spacing-lg);
    margin-top: var(--spacing-xl);
}

.footer-content {
    display: flex;
    align-items: center;
    gap: var(--spacing-lg);
    flex-wrap: wrap;
    font-size: var(--font-label);
    color: #6b7280;
}

.footer-section {
    display: flex;
    align-items: center;
    gap: 8px;
}

.footer-section i {
    font-size: 14px;
    color: var(--accent-teal);
}

.footer-separator {
    opacity: 0.5;
}

.footer-link {
    cursor: pointer;
    transition: color 0.2s;
}

.footer-link:hover {
    color: var(--accent-teal);
}

/* ========================================
   RESPONSIVE ADJUSTMENTS
   ======================================== */

@media (max-width: 768px) {
    .quick-stats-bar {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-sm);
        padding: var(--spacing-sm);
    }
    
    .stat-item {
        flex-direction: column;
        align-items: flex-start;
        border-right: none;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        padding: var(--spacing-sm);
    }
    
    .stat-item:nth-last-child(-n+2) {
        border-bottom: none;
    }
    
    .stat-item i {
        font-size: 24px;
    }
    
    .status-badge-group {
        flex-direction: column;
        align-items: flex-start;
        width: 100%;
    }
    
    .status-badge {
        width: 100%;
        justify-content: center;
    }
    
    .section-header {
        flex-direction: column;
        gap: var(--spacing-sm);
    }
    
    .help-icon-btn {
        width: 32px;
        height: 32px;
        font-size: 14px;
    }
}

/* Accessibility - Visible focus indicators */
*:focus-visible {
    outline: 2px solid var(--accent-teal);
    outline-offset: 2px;
    border-radius: var(--radius-badge);
}

/* Skip to content link for screen readers */
.skip-to-content {
    position: absolute;
    top: -40px;
    left: 0;
    background: var(--accent-teal);
    color: #000;
    padding: 8px 16px;
    text-decoration: none;
    border-radius: 0 0 var(--radius-badge) 0;
    z-index: 10000;
    font-weight: 600;
}

.skip-to-content:focus {
    top: 0;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    :root {
        --bg-primary: #000;
        --bg-secondary: #111;
    }
    
    .neo-card {
        border-width: 2px;
    }
    
    .status-badge {
        border-width: 2px;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
    
    .skeleton-loader {
        animation: none;
        background: rgba(255, 255, 255, 0.08);
    }
}

/* ========================================
   PHASE 2: ONBOARDING TOUR STYLES
   ======================================== */

.tour-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 10000;
    backdrop-filter: blur(3px);
}

.tour-spotlight {
    position: absolute;
    border: 3px solid var(--accent-teal);
    border-radius: var(--radius-card);
    box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7),
                0 0 20px var(--accent-teal);
    pointer-events: none;
    transition: all 0.3s ease;
    animation: spotlightPulse 2s ease-in-out infinite;
}

@keyframes spotlightPulse {
    0%, 100% {
        box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7),
                    0 0 20px var(--accent-teal);
    }
    50% {
        box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7),
                    0 0 30px var(--accent-teal),
                    0 0 40px var(--accent-teal);
    }
}

.tour-tooltip {
    position: fixed;
    background: var(--bg-secondary);
    border: 2px solid var(--accent-teal);
    border-radius: var(--radius-card);
    padding: 0;
    max-width: 400px;
    z-index: 10001;
    box-shadow: var(--shadow-elevated), 0 0 30px rgba(0, 212, 170, 0.3);
    animation: tourFadeIn 0.3s ease;
}

@keyframes tourFadeIn {
    from {
        opacity: 0;
        transform: scale(0.9);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.tour-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-md);
    background: linear-gradient(135deg, var(--accent-teal), var(--accent-cyan));
    border-radius: var(--radius-card) var(--radius-card) 0 0;
}

.tour-header h3 {
    margin: 0;
    color: #000;
    font-size: 18px;
    font-weight: 600;
}

.tour-step-indicator {
    background: rgba(0, 0, 0, 0.2);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    color: #000;
}

.tour-body {
    padding: var(--spacing-md);
    color: #e5e7eb;
}

.tour-body p {
    margin: 0;
    line-height: 1.6;
    font-size: 14px;
}

.tour-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-md);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.tour-navigation {
    display: flex;
    gap: var(--spacing-sm);
}

/* ========================================
   ENHANCED NOTIFICATIONS
   ======================================== */

.notification-container {
    position: fixed;
    top: 80px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
    max-width: 400px;
    pointer-events: none;
}

.enhanced-notification {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-sm);
    padding: var(--spacing-md);
    background: var(--bg-secondary);
    border-radius: var(--radius-card);
    box-shadow: var(--shadow-elevated);
    border-left: 4px solid var(--accent-teal);
    opacity: 0;
    transform: translateX(400px);
    transition: all 0.3s ease;
    pointer-events: all;
    min-width: 300px;
}

.enhanced-notification.show {
    opacity: 1;
    transform: translateX(0);
}

.notification-success {
    border-left-color: #10b981;
}

.notification-error {
    border-left-color: #ef4444;
}

.notification-warning {
    border-left-color: #f59e0b;
}

.notification-info {
    border-left-color: var(--accent-cyan);
}

.notification-icon {
    font-size: 24px;
    margin-top: 2px;
}

.notification-success .notification-icon {
    color: #10b981;
}

.notification-error .notification-icon {
    color: #ef4444;
}

.notification-warning .notification-icon {
    color: #f59e0b;
}

.notification-info .notification-icon {
    color: var(--accent-cyan);
}

.notification-content {
    flex: 1;
}

.notification-title {
    font-weight: 600;
    font-size: 14px;
    color: #f9fafb;
    margin-bottom: 4px;
}

.notification-message {
    font-size: 13px;
    color: #9ca3af;
    line-height: 1.5;
}

.notification-action {
    padding: 6px 12px;
    background: var(--accent-teal);
    color: #000;
    border: none;
    border-radius: var(--radius-button);
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    margin-right: var(--spacing-sm);
}

.notification-action:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 212, 170, 0.3);
}

.notification-close {
    width: 24px;
    height: 24px;
    border: none;
    background: transparent;
    color: #6b7280;
    cursor: pointer;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    font-size: 14px;
}

.notification-close:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #f9fafb;
}

/* Mobile responsive notifications */
@media (max-width: 768px) {
    .notification-container {
        right: 10px;
        left: 10px;
        max-width: none;
    }
    
    .enhanced-notification {
        min-width: auto;
    }
    
    .tour-tooltip {
        max-width: calc(100vw - 40px);
        left: 20px !important;
        right: 20px;
    }
}

/* ========================================
   MOBILE TOUCH OPTIMIZATIONS
   ======================================== */

/* Minimum touch target size (WCAG 2.1 Level AAA: 44√ó44px, we use 48√ó48px) */
@media (max-width: 768px) {
    /* Larger touch targets for buttons */
    .btn,
    .help-icon-btn,
    .badge-link,
    .notification-close {
        min-width: 48px;
        min-height: 48px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    
    /* Cards are swipeable */
    .neo-card {
        touch-action: pan-y;
        user-select: none;
        transition: transform 0.3s ease;
    }
    
    .neo-card.swiping {
        transition: none;
    }
    
    /* Bottom navigation for mobile */
    .mobile-bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--bg-secondary);
        border-top: 2px solid rgba(0, 212, 170, 0.3);
        display: flex;
        justify-content: space-around;
        padding: var(--spacing-sm) 0;
        z-index: 1000;
        box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .mobile-nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        color: #9ca3af;
        text-decoration: none;
        padding: var(--spacing-sm);
        border-radius: var(--radius-button);
        transition: all 0.2s;
        min-width: 64px;
        min-height: 48px;
    }
    
    .mobile-nav-item.active {
        color: var(--accent-teal);
        background: rgba(0, 212, 170, 0.1);
    }
    
    .mobile-nav-item:hover {
        color: var(--accent-teal);
    }
    
    .mobile-nav-item i {
        font-size: 20px;
    }
    
    .mobile-nav-item span {
        font-size: 11px;
        font-weight: 600;
    }
    
    /* Add padding to body to account for bottom nav */
    .dashboard-container {
        padding-bottom: 80px;
    }
    
    /* Larger tap areas for status cards */
    .neo-card {
        padding: var(--spacing-lg);
    }
    
    /* Make system info bar scrollable on mobile */
    .system-info-bar {
        overflow-x: auto;
        overflow-y: hidden;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none; /* Firefox */
    }
    
    .system-info-bar::-webkit-scrollbar {
        display: none; /* Chrome, Safari */
    }
    
    /* Stack quick stats vertically on very small screens */
    @media (max-width: 480px) {
        .quick-stats-bar {
            flex-direction: column;
        }
        
        .stat-item {
            width: 100%;
            justify-content: flex-start;
        }
    }
}

/* PWA Install Prompt */
.pwa-install-prompt {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-secondary);
    border: 2px solid var(--accent-teal);
    border-radius: var(--radius-card);
    padding: var(--spacing-md);
    box-shadow: var(--shadow-elevated);
    display: none;
    z-index: 9999;
    max-width: 90%;
    animation: slideUp 0.3s ease;
}

@keyframes slideUp {
    from {
        transform: translateX(-50%) translateY(100px);
        opacity: 0;
    }
    to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }
}

.pwa-install-prompt.show {
    display: block;
}

.pwa-prompt-content {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-md);
}

.pwa-prompt-icon {
    font-size: 32px;
    color: var(--accent-teal);
}

.pwa-prompt-text h4 {
    margin: 0 0 4px 0;
    font-size: 16px;
    color: #f9fafb;
}

.pwa-prompt-text p {
    margin: 0;
    font-size: 13px;
    color: #9ca3af;
}

.pwa-prompt-actions {
    display: flex;
    gap: var(--spacing-sm);
}

.pwa-prompt-actions button {
    flex: 1;
}

/* Touch feedback */
@media (hover: none) {
    .btn:active,
    .neo-card:active,
    .mobile-nav-item:active {
        transform: scale(0.98);
    }
}

</style>

<script>
// Modern dashboard functionality

function showTimerModal() {
    const modal = new bootstrap.Modal(document.getElementById('timerModal'));
    modal.show();
}

function setTimer() {
    const timerValue = document.getElementById('timer-input').value;
    
    fetch('/api/settings', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            timer_duration: parseInt(timerValue)
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById('timer-set').textContent = timerValue + 's';
            showNotification('Timer set successfully!', 'success');
            bootstrap.Modal.getInstance(document.getElementById('timerModal')).hide();
        } else {
            showNotification('Error setting timer', 'error');
        }
    })
    .catch(error => {
        showNotification('Error: ' + error, 'error');
    });
}



function backupDatabase() {
    const btn = event.target.closest('.control-btn');
    const originalContent = btn.innerHTML;
    
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>BACKING UP...</span>';
    btn.style.pointerEvents = 'none';
    
    fetch('/api/backup')
    .then(response => {
        if (response.ok) {
            return response.blob();
        }
        throw new Error('Backup failed');
    })
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `alarm_system_backup_${new Date().toISOString().split('T')[0]}.db`;
        a.click();
        window.URL.revokeObjectURL(url);
        showNotification('Database backup completed!', 'success');
    })
    .catch(error => {
        showNotification('Backup failed: ' + error, 'error');
    })
    .finally(() => {
        btn.innerHTML = originalContent;
        btn.style.pointerEvents = 'auto';
    });
}

function showAutoBackupModal() {
    const modal = new bootstrap.Modal(document.getElementById('autoBackupModal'));
    modal.show();
}

function setAutoBackup() {
    const interval = document.getElementById('backup-interval').value;
    const enabled = document.getElementById('auto-backup-enabled').checked;
    
    if (enabled) {
        // Start auto backup
        showNotification(`Auto backup enabled - every ${interval} minutes`, 'success');
        startAutoBackup(parseInt(interval) * 60000); // Convert to milliseconds
    } else {
        // Stop auto backup
        showNotification('Auto backup disabled', 'info');
        stopAutoBackup();
    }
    
    bootstrap.Modal.getInstance(document.getElementById('autoBackupModal')).hide();
}

let autoBackupInterval;

function startAutoBackup(intervalMs) {
    stopAutoBackup(); // Clear any existing interval
    autoBackupInterval = setInterval(() => {
        backupDatabase();
    }, intervalMs);
}

function stopAutoBackup() {
    if (autoBackupInterval) {
        clearInterval(autoBackupInterval);
        autoBackupInterval = null;
    }
}

function testSystem() {
    const btn = event.target.closest('.control-btn');
    const originalContent = btn.innerHTML;
    
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>TESTING...</span>';
    btn.style.pointerEvents = 'none';
    
    // Simulate system test
    setTimeout(() => {
        showNotification('System test completed - All systems operational', 'success');
        btn.innerHTML = originalContent;
        btn.style.pointerEvents = 'auto';
    }, 3000);
}



function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} position-fixed`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px; animation: slideInRight 0.3s ease;';
    notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
        ${message}
        <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
    `;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentElement) {
            notification.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }
    }, 5000);
}

async function manualRefresh() {
    console.log('üîÑ Manual refresh triggered');
    const refreshBtn = document.querySelector('.btn-system-refresh');
    
    if (refreshBtn) {
        refreshBtn.classList.add('btn-loading');
        refreshBtn.setAttribute('aria-busy', 'true');
    }
    
    showNotification('Refreshing dashboard data...', 'info');
    
    try {
        // Refresh statistics with error handling
        const data = await fetchWithErrorHandling('/api/statistics', { 
            loadingId: 'btn-system-refresh' 
        });
        
        // Update statistics on the page
        const totalEventsEl = document.getElementById('total-events');
        const totalEventsLoggedEl = document.getElementById('totalEventsLogged');
        const doorOpenEventsEl = document.getElementById('door-open-events');
        const doorCloseEventsEl = document.getElementById('door-close-events');
        const alarmEventsEl = document.getElementById('alarm-events');
        
        if (totalEventsEl) totalEventsEl.textContent = data.total_events || 0;
        if (totalEventsLoggedEl) totalEventsLoggedEl.textContent = `${data.total_events || 0} Events`;
        if (doorOpenEventsEl) doorOpenEventsEl.textContent = data.door_open_events || 0;
        if (doorCloseEventsEl) doorCloseEventsEl.textContent = data.door_close_events || 0;
        if (alarmEventsEl) alarmEventsEl.textContent = data.alarm_events || 0;
        
        hideErrorMessage();
        showNotification('Dashboard refreshed successfully!', 'success');
        
        // Announce to screen readers
        const announcement = document.createElement('div');
        announcement.setAttribute('role', 'status');
        announcement.setAttribute('aria-live', 'polite');
        announcement.className = 'visually-hidden';
        announcement.textContent = 'Dashboard data has been refreshed';
        document.body.appendChild(announcement);
        setTimeout(() => announcement.remove(), 1000);
        
    } catch (error) {
        console.error('Error refreshing statistics:', error);
        showNotification('Failed to refresh dashboard data', 'error');
    } finally {
        if (refreshBtn) {
            refreshBtn.classList.remove('btn-loading');
            refreshBtn.removeAttribute('aria-busy');
        }
    }
    
    // Force WebSocket reconnection if needed
    if (window.dashboardSocket && window.dashboardSocket.disconnected) {
        console.log('üîÑ Reconnecting WebSocket...');
        window.dashboardSocket.connect();
    }
}

// ========================================
// CUSTOMER-FOCUSED: Dynamic Status Updates
// ========================================

// Update system status badge based on actual system state
function updateSystemStatus() {
    const doorStatus = document.getElementById('door-status')?.textContent.trim();
    const alarmStatus = document.getElementById('alarm-status')?.textContent.trim();
    const statusBadge = document.getElementById('systemStatusBadge');
    const statusText = document.getElementById('systemStatusText');
    
    if (!statusBadge || !statusText) return;
    
    // Check if there are any issues
    const doorOpen = doorStatus && doorStatus.toLowerCase() !== 'closed';
    const alarmActive = alarmStatus && alarmStatus.toLowerCase() === 'active';
    
    if (alarmActive) {
        statusBadge.className = 'status-badge system-alert';
        statusBadge.querySelector('i').className = 'fas fa-exclamation-triangle';
        statusText.textContent = 'Alarm Active!';
    } else if (doorOpen) {
        statusBadge.className = 'status-badge system-warning';
        statusBadge.querySelector('i').className = 'fas fa-exclamation-circle';
        statusText.textContent = 'Door Open';
    } else {
        statusBadge.className = 'status-badge system-operational';
        statusBadge.querySelector('i').className = 'fas fa-check-circle';
        statusText.textContent = 'All Systems Operational';
    }
}

// Update blockchain badge visibility and count
function updateBlockchainBadge(blockCount) {
    const badge = document.getElementById('blockchainBadge');
    const countElement = document.getElementById('blockchainBlockCount');
    const statsCount = document.getElementById('blockchainCount');
    
    if (!badge) return;
    
    // Update count displays
    if (countElement) countElement.textContent = blockCount;
    if (statsCount) statsCount.textContent = `${blockCount} Blocks`;
    
    // Show badge only if blocks exist
    if (blockCount > 0) {
        badge.style.display = 'flex';
    } else {
        badge.style.display = 'none';
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    updateSystemStatus();
    
    // Update system status whenever door/alarm changes
    const observer = new MutationObserver(updateSystemStatus);
    
    const doorStatusEl = document.getElementById('door-status');
    const alarmStatusEl = document.getElementById('alarm-status');
    
    if (doorStatusEl) {
        observer.observe(doorStatusEl, { childList: true, characterData: true, subtree: true });
    }
    if (alarmStatusEl) {
        observer.observe(alarmStatusEl, { childList: true, characterData: true, subtree: true });
    }
    
    console.log('‚úÖ Customer-focused status monitoring initialized');
});

// ========================================
// REVOLUTIONARY VISUAL EFFECTS
// ========================================

// Particle Field Animation (Japanese Minimalism)
function initParticles() {
    const canvas = document.getElementById('particleCanvas');
    if (!canvas) return;
    
    const parent = canvas.parentElement;
    canvas.width = parent.offsetWidth;
    canvas.height = parent.offsetHeight;
    const ctx = canvas.getContext('2d');
    
    const particles = [];
    const particleCount = 80;
    
    class Particle {
        constructor() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.vx = (Math.random() - 0.5) * 0.5;
            this.vy = (Math.random() - 0.5) * 0.5;
            this.radius = Math.random() * 2 + 1;
        }
        
        update() {
            this.x += this.vx;
            this.y += this.vy;
            
            if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
            if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
        }
        
        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(102, 126, 234, ${Math.random() * 0.5 + 0.2})`;
            ctx.fill();
        }
    }
    
    for (let i = 0; i < particleCount; i++) {
        particles.push(new Particle());
    }
    
    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        particles.forEach((particle, i) => {
            particle.update();
            particle.draw();
            
            // Connect nearby particles
            particles.slice(i + 1).forEach(otherParticle => {
                const dx = particle.x - otherParticle.x;
                const dy = particle.y - otherParticle.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 100) {
                    ctx.beginPath();
                    ctx.strokeStyle = `rgba(102, 126, 234, ${0.2 * (1 - distance / 100)})`;
                    ctx.lineWidth = 0.5;
                    ctx.moveTo(particle.x, particle.y);
                    ctx.lineTo(otherParticle.x, otherParticle.y);
                    ctx.stroke();
                }
            });
        });
        
        requestAnimationFrame(animate);
    }
    
    animate();
}

// Quantum Data Visualization (Multi-national Fusion)
function initQuantumCanvas() {
    const canvas = document.getElementById('quantumCanvas');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    let time = 0;
    
    function drawQuantumWave() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        time += 0.01;
        
        // Draw multiple wave layers
        for (let layer = 0; layer < 3; layer++) {
            ctx.beginPath();
            ctx.strokeStyle = `rgba(${102 + layer * 30}, ${126 + layer * 20}, 234, ${0.3 - layer * 0.1})`;
            ctx.lineWidth = 2 - layer * 0.5;
            
            for (let x = 0; x < canvas.width; x += 5) {
                const y = canvas.height / 2 + 
                         Math.sin(x * 0.01 + time + layer) * 30 +
                         Math.sin(x * 0.02 - time * 0.5) * 20;
                
                if (x === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
        }
        
        requestAnimationFrame(drawQuantumWave);
    }
    
    drawQuantumWave();
}

// ========================================
// AI STATS LOADER
// ========================================

function loadAIStats() {
    fetch('/api/ai/stats')
        .then(response => response.json())
        .then(data => {
            if (data.success && data.ai_stats) {
                const stats = data.ai_stats;
                
                // Update AI Status Badge
                const statusBadge = document.getElementById('ai-status-badge');
                const statusText = document.getElementById('ai-status-text');
                if (stats.status === 'active') {
                    statusBadge.style.background = 'rgba(38, 222, 129, 0.1)';
                    statusBadge.style.borderColor = '#26de81';
                    statusText.style.color = '#26de81';
                    statusText.textContent = 'ACTIVE & LEARNING';
                } else {
                    statusBadge.style.background = 'rgba(247, 183, 49, 0.1)';
                    statusBadge.style.borderColor = '#f7b731';
                    statusText.style.color = '#f7b731';
                    statusText.textContent = 'LEARNING MODE';
                }
                
                // Update AI Accuracy
                const accuracy = Math.round(stats.ai_accuracy || 0);
                document.getElementById('ai-accuracy-value').textContent = accuracy;
                document.getElementById('ai-accuracy-bar').style.width = accuracy + '%';
                if (accuracy >= 90) {
                    document.getElementById('ai-accuracy-info').textContent = 'Excellent - Highly accurate';
                } else if (accuracy >= 75) {
                    document.getElementById('ai-accuracy-info').textContent = 'Good - Still improving';
                } else if (accuracy >= 60) {
                    document.getElementById('ai-accuracy-info').textContent = 'Learning - Collecting data';
                } else {
                    document.getElementById('ai-accuracy-info').textContent = 'Initializing - Need more events';
                }
                
                // Update Threat Level
                const threatLevel = stats.current_threat_level || 'LOW';
                const threatValue = document.getElementById('ai-threat-value');
                const threatInfo = document.getElementById('ai-threat-info');
                const threatDisplay = threatValue.parentElement;
                
                threatValue.textContent = threatLevel;
                
                // Color code threat level
                const threatColors = {
                    'LOW': { bg: 'rgba(38, 222, 129, 0.2)', color: '#26de81', text: 'All systems normal' },
                    'MEDIUM': { bg: 'rgba(247, 183, 49, 0.2)', color: '#f7b731', text: 'Elevated activity detected' },
                    'HIGH': { bg: 'rgba(253, 114, 114, 0.2)', color: '#fd7272', text: 'Suspicious patterns found' },
                    'CRITICAL': { bg: 'rgba(252, 92, 101, 0.2)', color: '#fc5c65', text: 'Immediate attention required' }
                };
                
                const threat = threatColors[threatLevel];
                threatDisplay.style.background = threat.bg;
                threatDisplay.style.color = threat.color;
                threatInfo.textContent = threat.text;
                
                // Activate threat segments
                document.querySelectorAll('.threat-segment').forEach(seg => seg.classList.remove('active'));
                if (threatLevel === 'LOW') {
                    document.querySelector('.threat-segment.low').classList.add('active');
                } else if (threatLevel === 'MEDIUM') {
                    document.querySelector('.threat-segment.low').classList.add('active');
                    document.querySelector('.threat-segment.medium').classList.add('active');
                } else if (threatLevel === 'HIGH') {
                    document.querySelector('.threat-segment.low').classList.add('active');
                    document.querySelector('.threat-segment.medium').classList.add('active');
                    document.querySelector('.threat-segment.high').classList.add('active');
                } else if (threatLevel === 'CRITICAL') {
                    document.querySelectorAll('.threat-segment').forEach(seg => seg.classList.add('active'));
                }
                
                // Update Security Score
                const securityScore = Math.round(stats.security_score || 0);
                document.getElementById('ai-security-score').textContent = securityScore;
                const scoreFill = document.getElementById('security-score-fill');
                scoreFill.style.width = securityScore + '%';
                
                // Color code security score
                if (securityScore >= 80) {
                    scoreFill.style.background = 'linear-gradient(90deg, #26de81, #4facfe)';
                    document.getElementById('ai-security-info').textContent = 'Excellent security';
                } else if (securityScore >= 60) {
                    scoreFill.style.background = 'linear-gradient(90deg, #f7b731, #4facfe)';
                    document.getElementById('ai-security-info').textContent = 'Good security';
                } else if (securityScore >= 40) {
                    scoreFill.style.background = 'linear-gradient(90deg, #fd7272, #f7b731)';
                    document.getElementById('ai-security-info').textContent = 'Moderate concerns';
                } else {
                    scoreFill.style.background = 'linear-gradient(90deg, #fc5c65, #f5576c)';
                    document.getElementById('ai-security-info').textContent = 'Critical attention needed';
                }
                
                // Update Incidents Prevented
                const incidentsPrevented = stats.incidents_prevented || 0;
                document.getElementById('ai-incidents-value').textContent = incidentsPrevented;
                if (incidentsPrevented > 50) {
                    document.getElementById('ai-incidents-info').textContent = 'High threat mitigation';
                } else if (incidentsPrevented > 10) {
                    document.getElementById('ai-incidents-info').textContent = 'Active protection';
                } else if (incidentsPrevented > 0) {
                    document.getElementById('ai-incidents-info').textContent = 'Anomalies detected';
                } else {
                    document.getElementById('ai-incidents-info').textContent = 'No threats detected';
                }
                
                // Update Events Analyzed
                const eventsAnalyzed = stats.events_analyzed || 0;
                document.getElementById('ai-events-value').textContent = eventsAnalyzed.toLocaleString();
                if (eventsAnalyzed > 1000) {
                    document.getElementById('ai-events-info').textContent = 'High volume - Advanced patterns';
                } else if (eventsAnalyzed > 100) {
                    document.getElementById('ai-events-info').textContent = 'Building pattern database';
                } else {
                    document.getElementById('ai-events-info').textContent = 'Initial learning phase';
                }
                
                // Update Patterns Learned
                const patternsLearned = stats.patterns_learned || 0;
                document.getElementById('ai-patterns-value').textContent = patternsLearned;
                if (patternsLearned >= 20) {
                    document.getElementById('ai-patterns-info').textContent = 'Comprehensive knowledge base';
                } else if (patternsLearned >= 10) {
                    document.getElementById('ai-patterns-info').textContent = 'Expanding pattern library';
                } else {
                    document.getElementById('ai-patterns-info').textContent = 'Early pattern recognition';
                }
                
                // Update stream items
                const protectionText = document.getElementById('ai-protection-text');
                if (stats.status === 'active') {
                    protectionText.textContent = `AI Active (${accuracy}% Accuracy)`;
                } else {
                    protectionText.textContent = 'AI Learning Patterns...';
                }
                
                const threatText = document.getElementById('ai-threat-text');
                threatText.textContent = `Threat: ${threatLevel}`;
                const threatColors2 = {
                    'LOW': '#26de81',
                    'MEDIUM': '#f7b731',
                    'HIGH': '#fd7272',
                    'CRITICAL': '#fc5c65'
                };
                threatText.parentElement.style.borderColor = threatColors2[threatLevel];
                
                const monitoringText = document.getElementById('ai-monitoring-text');
                monitoringText.textContent = `${eventsAnalyzed} Events Analyzed`;
                
                // Don't spam activity feed with normal stats updates
                // Security alerts are only shown for actual anomalies/threats
                
                console.log('[AI] Stats updated:', stats);
            }
        })
        .catch(error => {
            console.error('[AI] Failed to load stats:', error);
        });
}

// Add activity to AI feed
function addAIActivity(text, icon = 'brain') {
    const feed = document.getElementById('ai-activity-feed');
    if (!feed) return; // Old activity feed removed
    
    const now = new Date();
    const timeStr = now.toLocaleTimeString();
    
    const activityHtml = `
        <div class="ai-activity-item">
            <div class="activity-time">${timeStr}</div>
            <div class="activity-icon"><i class="fas fa-${icon}"></i></div>
            <div class="activity-text">${text}</div>
        </div>
    `;
    
    // Keep only last 10 activities
    if (feed.children.length >= 10) {
        feed.removeChild(feed.lastChild);
    }
    
    feed.insertAdjacentHTML('afterbegin', activityHtml);
}

// Add security alert (only important events)
function addSecurityAlert(text, subtext, severity = 'info') {
    const feed = document.getElementById('security-alerts-feed');
    if (!feed) return;
    
    // Remove "no alerts" message if present
    const noAlerts = feed.querySelector('.no-alerts');
    if (noAlerts) {
        noAlerts.remove();
    }
    
    const now = new Date();
    const timeStr = now.toLocaleTimeString();
    
    let iconClass, severityClass;
    if (severity === 'critical') {
        iconClass = 'fa-exclamation-triangle';
        severityClass = 'critical';
    } else if (severity === 'warning') {
        iconClass = 'fa-exclamation-circle';
        severityClass = 'warning';
    } else {
        iconClass = 'fa-info-circle';
        severityClass = '';
    }
    
    const alertHtml = `
        <div class="security-alert-item ${severityClass}">
            <div class="alert-icon"><i class="fas ${iconClass}"></i></div>
            <div>
                <div class="alert-text">${text}</div>
                <div class="alert-subtext">${subtext}</div>
                <div class="alert-time">${timeStr}</div>
            </div>
        </div>
    `;
    
    // Keep only last 5 alerts
    if (feed.children.length >= 5) {
        feed.removeChild(feed.lastChild);
    }
    
    feed.insertAdjacentHTML('afterbegin', alertHtml);
}

// Load AI stats on page load and refresh every 30 seconds
loadAIStats();
setInterval(loadAIStats, 30000);

// Initialize effects on load
setTimeout(() => {
    initParticles();
    initQuantumCanvas();
}, 100);

// Initialize dashboard
document.addEventListener('DOMContentLoaded', function() {
    // Add CSS animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    `;
    document.head.appendChild(style);
    
    // Load blockchain status
    loadBlockchainStatus();
});

// Load blockchain verification status
function loadBlockchainStatus() {
    fetch('/api/blockchain/stats')
        .then(response => response.json())
        .then(data => {
            if (data.success && data.blockchain_exists) {
                const blockCount = data.total_blocks || 0;
                
                // Update blockchain badge with new customer-focused function
                updateBlockchainBadge(blockCount);
                
                const badge = document.getElementById('blockchainBadge');
                if (!badge) return;
                
                // Update badge styling based on verification
                if (data.verified) {
                    badge.style.borderColor = 'rgba(16, 185, 129, 0.3)';
                    badge.style.color = '#10b981';
                } else {
                    badge.style.borderColor = 'rgba(239, 68, 68, 0.3)';
                    badge.style.color = '#ef4444';
                }
            } else {
                // Hide blockchain badge if not available
                updateBlockchainBadge(0);
            }
        })
        .catch(error => {
            console.log('Blockchain status not available');
            updateBlockchainBadge(0);
        });
}

// Dashboard-specific real-time updates are now handled by socket.js
// This duplicate event handler has been removed to prevent conflicts
</script>

<!-- Dashboard Auto-Refresh Component (Same as Event Log) -->
<script>
class DashboardAutoRefresh {
    constructor() {
        this.refreshRate = 3000; // 3 seconds - same as event log
        this.refreshInterval = null;
        this.isAutoRefreshEnabled = true;
        this.lastDataHash = null;
        this.newUpdatesCount = 0;
        this.consecutiveErrors = 0;
        this.maxErrors = 3;
        
        this.init();
    }
    
    init() {
        console.log('üîÑ Dashboard Auto-Refresh Component Initialized');
        console.log('  ‚îú‚îÄ Refresh Rate: 3 seconds');
        console.log('  ‚îú‚îÄ Auto-refresh: ENABLED');
        console.log('  ‚îî‚îÄ Monitoring dashboard data changes...');
        
        this.startAutoRefresh();
        this.setupWebSocketFallback();
        this.updateLastRefreshTime();
    }
    
    startAutoRefresh() {
        if (this.refreshInterval) {
            clearInterval(this.refreshInterval);
        }
        
        this.refreshInterval = setInterval(() => {
            if (this.isAutoRefreshEnabled) {
                this.checkForUpdates();
            }
        }, this.refreshRate);
        
        console.log('‚úÖ Dashboard auto-refresh started (every 3 seconds)');
        this.updateLiveIndicator(true);
    }
    
    stopAutoRefresh() {
        if (this.refreshInterval) {
            clearInterval(this.refreshInterval);
            this.refreshInterval = null;
        }
        console.log('‚è∏Ô∏è Dashboard auto-refresh paused');
        this.updateLiveIndicator(false);
    }
    
    async checkForUpdates() {
        try {
            console.log('üîç Checking for dashboard updates...');
            
            const response = await fetch('/api/dashboard');
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const data = await response.json();
            
            if (data.success) {
                // Create a hash of the important data to detect changes
                const dataHash = this.createDataHash(data);
                
                if (this.lastDataHash && this.lastDataHash !== dataHash) {
                    console.log('üì• Dashboard data changed, updating components...');
                    this.updateDashboardComponents(data);
                    this.newUpdatesCount++;
                    this.showUpdateNotification();
                } else if (!this.lastDataHash) {
                    // First load
                    console.log('üìã Initial dashboard data load');
                    this.updateDashboardComponents(data);
                } else {
                    console.log('üìã No dashboard changes detected');
                }
                
                this.lastDataHash = dataHash;
                this.consecutiveErrors = 0; // Reset error count on success
            }
            
            this.updateLastRefreshTime();
            
        } catch (error) {
            console.error('‚ùå Error checking for dashboard updates:', error);
            this.handleRefreshError(error);
        }
    }
    
    createDataHash(data) {
        // Create a simple hash of key dashboard data to detect changes
        const keyData = {
            door_status: data.door_status,
            alarm_status: data.alarm_status,
            timer_set: data.timer_set,
            total_events: data.total_events,
            door_open_events: data.door_open_events,
            door_close_events: data.door_close_events,
            alarm_events: data.alarm_events,
            last_event_id: data.last_event ? data.last_event.id : null,
            uptime_seconds: data.uptime ? data.uptime.uptime_seconds : null
        };
        return JSON.stringify(keyData);
    }
    
    updateDashboardComponents(data) {
        // Update Door Status
        this.updateElementWithAnimation('door-status', data.door_status);
        this.updateStatusIndicator('door-status', data.door_status, 'door');
        
        // Update Alarm Status  
        this.updateElementWithAnimation('alarm-status', data.alarm_status);
        this.updateStatusIndicator('alarm-status', data.alarm_status, 'alarm');
        
        // Update Timer Setting
        this.updateElementWithAnimation('timer-set', data.timer_set + 's');
        
        // Update Event Counters with animation
        this.updateCounterWithAnimation('total-events', data.total_events);
        this.updateCounterWithAnimation('door-open-events', data.door_open_events);
        this.updateCounterWithAnimation('door-close-events', data.door_close_events);
        this.updateCounterWithAnimation('alarm-events', data.alarm_events);
        
        // Update System Uptime
        if (data.uptime) {
            this.updateUptimeDisplay(data.uptime);
        }
        
        // Update recent events if there's a section for it
        if (data.recent_events) {
            this.updateRecentEvents(data.recent_events);
        }
        
        console.log('‚úÖ Dashboard components updated successfully');
    }
    
    updateElementWithAnimation(elementId, newValue) {
        const element = document.getElementById(elementId);
        if (element && element.textContent !== newValue) {
            element.textContent = newValue;
            this.addUpdateAnimation(element);
        }
    }
    
    updateCounterWithAnimation(elementId, newValue) {
        const element = document.getElementById(elementId);
        if (element) {
            const currentValue = parseInt(element.textContent) || 0;
            if (currentValue !== newValue) {
                this.animateCounter(element, currentValue, newValue);
            }
        }
    }
    
    animateCounter(element, fromValue, toValue) {
        const increment = toValue > fromValue ? 1 : -1;
        const steps = Math.abs(toValue - fromValue);
        const stepTime = Math.max(50, 300 / steps);
        
        let current = fromValue;
        element.classList.add('counter-updating');
        
        const counter = setInterval(() => {
            current += increment;
            element.textContent = current;
            
            if (current === toValue) {
                clearInterval(counter);
                element.classList.remove('counter-updating');
                this.addUpdateAnimation(element);
            }
        }, stepTime);
    }
    
    updateStatusIndicator(elementId, status, type) {
        const element = document.getElementById(elementId);
        if (!element) return;
        
        const panel = element.closest('.status-panel');
        const indicator = panel?.querySelector('.status-indicator-bar');
        
        if (indicator) {
            // Remove existing status classes
            indicator.classList.remove('safe', 'warning', 'danger', 'info', 'primary');
            
            // Add appropriate class based on status and type
            if (type === 'door') {
                indicator.classList.add(status === 'Closed' ? 'safe' : 'warning');
            } else if (type === 'alarm') {
                indicator.classList.add(status === 'Inactive' ? 'safe' : 'danger');
            }
        }
    }
    
    addUpdateAnimation(element) {
        if (!element) return;
        
        element.classList.add('updated');
        setTimeout(() => {
            element.classList.remove('updated');
        }, 1000);
    }
    
    updateUptimeDisplay(uptimeData) {
        const uptimeEl = document.getElementById('system-uptime');
        const availabilityEl = document.getElementById('uptime-availability');
        
        if (uptimeEl && uptimeData.uptime_string) {
            const currentUptime = uptimeEl.textContent;
            if (currentUptime !== uptimeData.uptime_string) {
                uptimeEl.textContent = uptimeData.uptime_string;
                this.addUpdateAnimation(uptimeEl);
            }
        }
        
        if (availabilityEl && uptimeData.availability_percent !== undefined) {
            const availabilityText = `${uptimeData.availability_percent}% Available`;
            if (availabilityEl.textContent !== availabilityText) {
                availabilityEl.textContent = availabilityText;
                
                // Color code availability
                if (uptimeData.availability_percent >= 99.5) {
                    availabilityEl.style.color = '#10b981'; // Green
                } else if (uptimeData.availability_percent >= 95) {
                    availabilityEl.style.color = '#f59e0b'; // Yellow
                } else {
                    availabilityEl.style.color = '#ef4444'; // Red
                }
            }
        }
        
        // Update tooltip with detailed info
        if (uptimeEl) {
            uptimeEl.title = `Started: ${new Date(uptimeData.start_time).toLocaleString()}\nUptime: ${uptimeData.days}d ${uptimeData.hours}h ${uptimeData.minutes}m ${uptimeData.seconds}s\nAvailability: ${uptimeData.availability_percent}%`;
        }
    }
    
    updateRecentEvents(events) {
        const recentEventsContainer = document.getElementById('recent-events');
        if (!recentEventsContainer || !events.length) return;
        
        // Update recent events display if it exists
        // This can be customized based on how recent events are displayed on dashboard
    }
    
    setupWebSocketFallback() {
        // Use WebSocket as primary, polling as fallback
        if (typeof socket !== 'undefined' && socket) {
            socket.on('new_event', (data) => {
                console.log('üì° WebSocket event received, updating dashboard immediately...');
                // Trigger immediate refresh when WebSocket event received
                this.checkForUpdates();
            });
            
            socket.on('disconnect', () => {
                console.log('üîÑ WebSocket disconnected, relying on polling');
                this.updateLiveIndicator(true); // Still live via polling
            });
        }
    }
    
    updateLiveIndicator(isLive) {
        // Connection status indicator removed - monitoring works silently in background
        // No visual indicator needed as real-time updates work automatically
        console.log(`üîÑ Monitoring status: ${isLive ? 'Active' : 'Paused'}`);
    }
    
    updateLastRefreshTime() {
        const lastUpdated = document.querySelector('.last-updated');
        if (lastUpdated) {
            lastUpdated.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
        }
    }
    
    showUpdateNotification() {
        // Background update - no visual notification needed
        // Just log to console for debugging if needed
        console.log('‚úÖ Dashboard data updated silently');
    }
    
    handleRefreshError(error) {
        this.consecutiveErrors++;
        
        if (this.consecutiveErrors >= this.maxErrors) {
            console.warn('‚ö†Ô∏è Multiple dashboard refresh errors, slowing down refresh rate');
            this.refreshRate = 10000; // Slow down to 10 seconds after multiple errors
            this.startAutoRefresh(); // Restart with new rate
        }
        
        // Error state logged to console only - no visual indicator
        console.log('‚ùå Dashboard monitoring experiencing connection issues');
        console.log(`Consecutive errors: ${this.consecutiveErrors}/${this.maxErrors}`);
    }
    
    toggle() {
        this.isAutoRefreshEnabled = !this.isAutoRefreshEnabled;
        
        if (this.isAutoRefreshEnabled) {
            this.startAutoRefresh();
        } else {
            this.stopAutoRefresh();
        }
    }
    
    // Public method to force refresh
    forceRefresh() {
        console.log('üîÑ Manual dashboard refresh triggered');
        this.checkForUpdates();
    }
}

// Initialize Dashboard Auto-Refresh when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Wait a moment for other scripts to initialize
    setTimeout(() => {
        window.dashboardAutoRefresh = new DashboardAutoRefresh();
        
        // Make available globally for debugging
        window.toggleDashboardRefresh = () => {
            window.dashboardAutoRefresh.toggle();
        };
        
        window.refreshDashboard = () => {
            window.dashboardAutoRefresh.forceRefresh();
        };
        
        console.log('‚úÖ Dashboard Auto-Refresh System Initialized');
        console.log('üí° Debug commands: toggleDashboardRefresh(), refreshDashboard()');
    }, 1000);
});

// ===========================================
// AUDIO ALERT SYSTEM
// ===========================================

// Initialize audio alert system on page load
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        initializeMobileAudioUI();
        checkAudioPermissions();
    }, 1500);
});

// Initialize audio alert UI and check permissions
function initializeMobileAudioUI() {
    console.log('üîä Initializing Audio Alert System...');
    
    // Check if MobileAudioManager is available
    if (typeof MobileAudioManager !== 'undefined') {
        window.audioManager = new MobileAudioManager();
        console.log('‚úÖ Audio Alert Manager initialized');
    } else {
        console.warn('‚ö†Ô∏è MobileAudioManager not found - audio features disabled');
        return;
    }
    
    // Set up periodic permission checks
    setInterval(checkAudioPermissions, 3000);
}

// Check and update permission status badges
async function checkAudioPermissions() {
    const audioPermissionBadge = document.getElementById('audioPermissionBadge');
    const notificationPermissionBadge = document.getElementById('notificationPermissionBadge');
    const enableAudioBtn = document.getElementById('enableAudioBtn');
    
    if (!audioPermissionBadge || !notificationPermissionBadge) return;
    
    // Check audio context state
    let audioAllowed = false;
    let audioMessage = 'Audio: Not Ready';
    
    if (window.audioManager && window.audioManager.audioContext) {
        if (window.audioManager.audioContext.state === 'running') {
            audioAllowed = true;
            audioMessage = 'Audio: Active';
        } else if (window.audioManager.audioContext.state === 'suspended') {
            audioMessage = 'Audio: Ready (Tap to Activate)';
        }
    } else {
        audioMessage = 'Audio: Click Enable Button';
    }
    
    // Check notification permission
    let notificationAllowed = false;
    let notificationMessage = 'Notifications: Denied';
    
    if ('Notification' in window) {
        switch (Notification.permission) {
            case 'granted':
                notificationAllowed = true;
                notificationMessage = 'Notifications: Enabled';
                break;
            case 'default':
                notificationMessage = 'Notifications: Click to Enable';
                break;
            case 'denied':
                notificationMessage = 'Notifications: Blocked';
                break;
        }
    } else {
        notificationMessage = 'Notifications: Not Supported';
    }
    
    // Update badges
    audioPermissionBadge.className = `badge ${audioAllowed ? 'bg-success' : 'bg-warning'}`;
    audioPermissionBadge.innerHTML = `<i class="fas ${audioAllowed ? 'fa-volume-up' : 'fa-volume-mute'}"></i> ${audioMessage}`;
    
    notificationPermissionBadge.className = `badge ${notificationAllowed ? 'bg-success' : 'bg-warning'}`;
    notificationPermissionBadge.innerHTML = `<i class="fas ${notificationAllowed ? 'fa-bell' : 'fa-bell-slash'}"></i> ${notificationMessage}`;
    
    // Enable/disable buttons based on permissions
    const buttonsEnabled = audioAllowed && notificationAllowed;
    enableControlButtons(buttonsEnabled);
    
    // Update enable button
    if (enableAudioBtn) {
        if (buttonsEnabled) {
            enableAudioBtn.className = 'btn btn-sm btn-success';
            enableAudioBtn.innerHTML = '<i class="fas fa-check"></i> Audio Enabled';
            enableAudioBtn.disabled = true;
        } else {
            enableAudioBtn.className = 'btn btn-sm btn-primary';
            enableAudioBtn.innerHTML = '<i class="fas fa-volume-up"></i> Enable Audio Alerts';
            enableAudioBtn.disabled = false;
        }
    }
}

// Enable or disable audio control buttons
function enableControlButtons(enabled) {
    const buttons = [
        'testDefaultBtn', 'testUrgentBtn', 'testGentleBtn', 
        'stopAlarmsBtn', 'testSelectedBtn', 'testFullAlarmBtn', 'testHooterBtn', 'ringtoneSelect'
    ];
    
    buttons.forEach(buttonId => {
        const button = document.getElementById(buttonId);
        if (button) {
            button.disabled = !enabled;
        }
    });
}

// Main function to enable audio alerts
async function enableMobileAudio() {
    console.log('üîä Enabling audio alerts...');
    
    if (!window.mobileAudioManager) {
        showNotification('Audio system not available', 'error');
        return;
    }
    
    try {
        // Show loading state
        const enableBtn = document.getElementById('enableAudioBtn');
        if (enableBtn) {
            enableBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enabling...';
            enableBtn.disabled = true;
        }
        
        // Request notification permission first (required for audio on mobile)
        if ('Notification' in window && Notification.permission === 'default') {
            const permission = await Notification.requestPermission();
            console.log('üì¢ Notification permission:', permission);
        }
        
        // Resume audio context (required for mobile browsers)
        if (window.mobileAudioManager.audioContext) {
            if (window.mobileAudioManager.audioContext.state === 'suspended') {
                await window.mobileAudioManager.audioContext.resume();
                console.log('‚úÖ Audio context resumed');
            }
        }
        
        // Test audio to ensure it's working
        showNotification('üîä Audio alert system enabled!', 'success');
        
        // Play a short confirmation sound
        setTimeout(() => {
            if (window.mobileAudioManager) {
                window.mobileAudioManager.playAlarmRingtone('gentle', 1500, false); // 1.5 second gentle beep
            }
        }, 500);
        
    } catch (error) {
        console.error('‚ùå Error enabling audio:', error);
        showNotification('Failed to enable audio: ' + error.message, 'error');
    }
    
    // Update UI
    setTimeout(checkAudioPermissions, 1000);
}

// Test alarm sound functions
function testAlarmSound(type) {
    if (!window.mobileAudioManager) {
        showNotification('Audio system not available', 'error');
        return;
    }
    
    console.log(`üîä Testing ${type} alarm sound`);
    
    try {
        window.mobileAudioManager.playAlarmRingtone(type, 3000, false); // 3 seconds duration
        showNotification(`Testing ${type} alarm sound`, 'info');
        
        // Update UI to show which sound is playing
        updatePlayingIndicator(type);
        
    } catch (error) {
        console.error('‚ùå Error playing sound:', error);
        showNotification('Failed to play sound: ' + error.message, 'error');
    }
}

// Stop all alarms
function stopAllAlarms() {
    if (!window.mobileAudioManager) {
        showNotification('Audio system not available', 'error');
        return;
    }
    
    console.log('üõë Stopping all alarms');
    
    try {
        window.mobileAudioManager.stopAlarm();
        showNotification('All alarms stopped', 'info');
        clearPlayingIndicator();
    } catch (error) {
        console.error('‚ùå Error stopping alarms:', error);
        showNotification('Error stopping alarms: ' + error.message, 'error');
    }
}

// Test full alarm (simulates real door alarm event)
function testFullAlarm() {
    if (!window.mobileAudioManager) {
        showNotification('Mobile audio system not available', 'error');
        return;
    }
    
    console.log('üö® Testing full alarm simulation');
    
    try {
        // Get selected ringtone
        const ringtoneSelect = document.getElementById('ringtoneSelect');
        const selectedRingtone = ringtoneSelect ? ringtoneSelect.value : 'urgent';
        
        // Trigger full alarm experience (30 seconds)
        window.mobileAudioManager.playAlarmRingtone(selectedRingtone, 30000);
        
        // Show persistent notification
        if (window.mobileAudioManager.showNotification) {
            window.mobileAudioManager.showNotification(
                'üö® TEST ALARM - eDOMOS Security Alert',
                'This is a test of the mobile alarm system. Real alarm would play for 30 seconds.',
                true // persistent
            );
        }
        
        showNotification('Full alarm test started (30 seconds) - this simulates a real door alarm!', 'warning');
        
        // Auto-stop message after 5 seconds for testing
        setTimeout(() => {
            showNotification('Test alarm continues... (tap notification to stop)', 'info');
        }, 5000);
        
    } catch (error) {
        console.error('‚ùå Error testing full alarm:', error);
        showNotification('Error testing alarm: ' + error.message, 'error');
    }
}

// Test 12V hooter siren
function testHooter() {
    console.log('üîä Testing 12V hooter siren');
    
    const btn = document.getElementById('testHooterBtn');
    if (!btn) return;
    
    // Disable button and show loading
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Testing...';
    
    fetch('/api/test-hooter', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCsrfToken()
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('üîä Hooter siren test started (2 seconds)', 'success');
            console.log('‚úÖ Hooter test successful:', data.message);
            
            // Re-enable button after test duration
            setTimeout(() => {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-volume-up"></i> Test Hooter';
            }, 3000);
        } else {
            throw new Error(data.error || 'Unknown error');
        }
    })
    .catch(error => {
        console.error('‚ùå Error testing hooter:', error);
        showNotification('Error testing hooter: ' + error.message, 'error');
        
        // Re-enable button on error
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-volume-up"></i> Test Hooter';
    });
}

// Set default ringtone
function setDefaultRingtone(type) {
    if (!window.audioManager) {
        showNotification('Audio system not available', 'error');
        return;
    }
    
    console.log(`üéµ Setting default ringtone to: ${type}`);
    
    try {
        window.audioManager.setDefaultRingtone(type);
        showNotification(`Default ringtone set to ${type}`, 'success');
        
        // Save preference to localStorage
        localStorage.setItem('edomos_default_ringtone', type);
        
    } catch (error) {
        console.error('‚ùå Error setting ringtone:', error);
        showNotification('Failed to set ringtone: ' + error.message, 'error');
    }
}

// Test currently selected ringtone
function testSelectedRingtone() {
    const select = document.getElementById('ringtoneSelect');
    if (select) {
        testAlarmSound(select.value);
    }
}

// Toggle vibration setting
function toggleVibration(enabled) {
    if (window.audioManager) {
        window.audioManager.vibrationEnabled = enabled;
        localStorage.setItem('edomos_vibration_enabled', enabled.toString());
        showNotification(`Vibration ${enabled ? 'enabled' : 'disabled'}`, 'info');
    }
}

// Toggle persistent notifications
function togglePersistentNotifications(enabled) {
    if (window.audioManager) {
        window.audioManager.persistentNotifications = enabled;
        localStorage.setItem('edomos_persistent_notifications', enabled.toString());
        showNotification(`Persistent notifications ${enabled ? 'enabled' : 'disabled'}`, 'info');
    }
}

// Update UI to show which sound is currently playing
function updatePlayingIndicator(type) {
    // Remove any existing playing indicators
    clearPlayingIndicator();
    
    // Add playing indicator to the current button
    const buttonMap = {
        'default': 'testDefaultBtn',
        'urgent': 'testUrgentBtn',
        'gentle': 'testGentleBtn',
        'classic': 'testSelectedBtn',
        'siren': 'testSelectedBtn'
    };
    
    const buttonId = buttonMap[type];
    if (buttonId) {
        const button = document.getElementById(buttonId);
        if (button) {
            button.classList.add('playing');
            button.innerHTML = button.innerHTML.replace('TEST', 'PLAYING');
        }
    }
    
    // Auto-clear after 4 seconds
    setTimeout(clearPlayingIndicator, 4000);
}

// Clear playing indicators
function clearPlayingIndicator() {
    const buttons = ['testDefaultBtn', 'testUrgentBtn', 'testGentleBtn', 'testSelectedBtn'];
    buttons.forEach(buttonId => {
        const button = document.getElementById(buttonId);
        if (button) {
            button.classList.remove('playing');
            // Restore original text
            if (button.innerHTML.includes('PLAYING')) {
                button.innerHTML = button.innerHTML.replace('PLAYING', 'TEST');
            }
        }
    });
}

// Load saved preferences
function loadAudioPreferences() {
    // Load default ringtone
    const savedRingtone = localStorage.getItem('edomos_default_ringtone');
    if (savedRingtone) {
        const select = document.getElementById('ringtoneSelect');
        if (select) {
            select.value = savedRingtone;
            if (window.audioManager) {
                window.audioManager.setDefaultRingtone(savedRingtone);
            }
        }
    }
    
    // Load vibration setting
    const vibrationEnabled = localStorage.getItem('edomos_vibration_enabled');
    if (vibrationEnabled !== null) {
        const checkbox = document.getElementById('vibrationEnabled');
        if (checkbox) {
            checkbox.checked = vibrationEnabled === 'true';
            if (window.audioManager) {
                window.audioManager.vibrationEnabled = checkbox.checked;
            }
        }
    }
    
    // Load persistent notifications setting
    const persistentEnabled = localStorage.getItem('edomos_persistent_notifications');
    if (persistentEnabled !== null) {
        const checkbox = document.getElementById('persistentNotifications');
        if (checkbox) {
            checkbox.checked = persistentEnabled === 'true';
            if (window.audioManager) {
                window.audioManager.persistentNotifications = checkbox.checked;
            }
        }
    }
}

// Load preferences when page is ready
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(loadAudioPreferences, 2000);
});

// Integrate with existing WebSocket events
if (typeof socket !== 'undefined') {
    // Override existing event handler to include audio notifications
    const originalNewEventHandler = socket._callbacks['$new_event'];
    
    socket.on('new_event', function(data) {
        // Call original handler if it exists
        if (originalNewEventHandler && originalNewEventHandler.length > 0) {
            originalNewEventHandler.forEach(callback => {
                if (typeof callback === 'function') {
                    callback(data);
                }
            });
        }
        
        // Check for AI anomaly detection in event metadata
        if (data.event && data.event.ai_metadata) {
            try {
                const aiData = typeof data.event.ai_metadata === 'string' 
                    ? JSON.parse(data.event.ai_metadata) 
                    : data.event.ai_metadata;
                
                if (aiData.ai_analysis) {
                    const analysis = aiData.ai_analysis;
                    
                    // Show security alert ONLY for anomalies (not normal events)
                    if (analysis.anomaly_detected) {
                        addSecurityAlert(
                            `Anomaly Detected: ${analysis.anomaly_reason}`,
                            `Confidence: ${analysis.anomaly_confidence}% - Recommend review`,
                            'warning'
                        );
                    }
                    
                    // Show critical alerts for HIGH/CRITICAL threats
                    if (analysis.threat_level === 'HIGH' || analysis.threat_level === 'CRITICAL') {
                        addSecurityAlert(
                            `${analysis.threat_level} Threat Detected`,
                            analysis.threat_prediction,
                            'critical'
                        );
                    }
                }
            } catch (e) {
                console.log('Could not parse AI metadata:', e);
            }
        }
        
        // Add audio alert notifications
        if (data.alarm_status && window.audioManager) {
            console.log('üö® Alarm active - triggering alert notification');
            
            if (data.event && data.event.event_type === 'door_opened') {
                // Play urgent alarm for door open events
                window.audioManager.playAlarmSound('urgent');
                window.audioManager.showNotification(
                    'SECURITY ALERT',
                    'Door opened while alarm is active!',
                    true // persistent
                );
            }
        } else if (!data.alarm_status && window.audioManager) {
            // Stop alarm when alarm becomes inactive
            window.audioManager.stopAlarm();
        }
        
        // Handle door close events
        if (data.event && data.event.event_type === 'door_closed' && window.audioManager) {
            window.audioManager.stopAlarm();
            console.log('üö™ Door closed - stopping alarms');
        }
    });
}

console.log('‚úÖ Audio Alert System Loaded');

// ============================================================================
// PHASE 1: ERROR HANDLING, LOADING STATES & ACCESSIBILITY
// ============================================================================

// Connection Status Monitor
let isOnline = true;
let reconnectAttempts = 0;
const maxReconnectAttempts = 5;

function updateConnectionStatus(status) {
    const statusElement = document.getElementById('connectionStatus');
    if (!statusElement) return;
    
    const statusDot = statusElement.querySelector('.status-dot');
    const statusText = statusElement.querySelector('.status-text');
    
    // Remove all status classes
    statusDot.classList.remove('status-online', 'status-reconnecting', 'status-offline');
    
    if (status === 'offline') {
        statusDot.classList.add('status-offline');
        statusText.textContent = 'Offline';
        statusElement.parentElement.style.color = '#ef4444';
        isOnline = false;
    } else if (status === 'reconnecting') {
        statusDot.classList.add('status-reconnecting');
        statusText.textContent = `Reconnecting (${reconnectAttempts}/${maxReconnectAttempts})`;
        statusElement.parentElement.style.color = '#f59e0b';
    } else {
        statusDot.classList.add('status-online');
        statusText.textContent = 'Online';
        statusElement.parentElement.style.color = '#e5e7eb';
        isOnline = true;
        reconnectAttempts = 0;
    }
}

// Enhanced fetch with error handling
async function fetchWithErrorHandling(url, options = {}) {
    const loadingId = options.loadingId;
    
    // Show loading state
    if (loadingId) {
        const element = document.getElementById(loadingId);
        if (element) {
            element.classList.add('btn-loading');
        }
    }
    
    try {
        const response = await fetch(url, {
            ...options,
            headers: {
                'Content-Type': 'application/json',
                ...options.headers
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        // Hide loading state
        if (loadingId) {
            const element = document.getElementById(loadingId);
            if (element) {
                element.classList.remove('btn-loading');
            }
        }
        
        updateConnectionStatus('online');
        return data;
        
    } catch (error) {
        console.error('Fetch error:', error);
        
        // Hide loading state
        if (loadingId) {
            const element = document.getElementById(loadingId);
            if (element) {
                element.classList.remove('btn-loading');
            }
        }
        
        // Handle network errors
        if (error.message.includes('Failed to fetch') || !navigator.onLine) {
            updateConnectionStatus('offline');
            reconnectAttempts++;
            
            if (reconnectAttempts < maxReconnectAttempts) {
                updateConnectionStatus('reconnecting');
                setTimeout(() => fetchWithErrorHandling(url, options), 3000 * reconnectAttempts);
            }
        }
        
        showErrorMessage('Unable to connect to server. Please check your connection.', () => {
            reconnectAttempts = 0;
            fetchWithErrorHandling(url, options);
        });
        
        throw error;
    }
}

// Show error message with retry option
function showErrorMessage(message, retryCallback) {
    let errorCard = document.getElementById('errorMessageCard');
    
    if (!errorCard) {
        errorCard = document.createElement('div');
        errorCard.id = 'errorMessageCard';
        errorCard.className = 'error-message-card';
        document.querySelector('.dashboard-container').insertBefore(
            errorCard, 
            document.querySelector('.section-header')
        );
    }
    
    errorCard.innerHTML = `
        <div style="display: flex; align-items: center;">
            <i class="fas fa-exclamation-triangle error-icon" aria-hidden="true"></i>
            <div style="flex: 1;">
                <strong>Connection Error</strong>
                <p style="margin: 4px 0 0 0; font-size: 13px; color: #9ca3af;">${message}</p>
            </div>
            <button class="retry-btn" onclick="retryConnection()" aria-label="Retry connection">
                <i class="fas fa-redo"></i> Retry
            </button>
        </div>
    `;
    
    errorCard.classList.add('show');
    errorCard.setAttribute('role', 'alert');
    errorCard.setAttribute('aria-live', 'assertive');
    
    // Store retry callback globally
    window.retryConnectionCallback = retryCallback;
}

function hideErrorMessage() {
    const errorCard = document.getElementById('errorMessageCard');
    if (errorCard) {
        errorCard.classList.remove('show');
    }
}

function retryConnection() {
    hideErrorMessage();
    if (window.retryConnectionCallback) {
        window.retryConnectionCallback();
    }
}

// Contextual Help System
const helpContent = {
    'door-status': {
        title: 'Door Status',
        content: 'Shows the current state of the monitored door. "Closed" indicates the door is secured. "Open" means the door is currently open and the timer may be running.'
    },
    'alarm-status': {
        title: 'Alarm Status',
        content: 'Indicates whether the alarm is currently active. "Inactive" means the system is in normal operation. "Active" means the alarm has been triggered due to the door being open too long.'
    },
    'timer-setting': {
        title: 'Timer Setting',
        content: 'The duration (in seconds) that the door can remain open before the alarm is triggered. This can be adjusted in the system controls by administrators.'
    },
    'live-camera': {
        title: 'Live Camera',
        content: 'Access the real-time camera feed to monitor the door area. Click "View Feed" to open the live video stream in a modal window.'
    },
    'total-events': {
        title: 'Total Events',
        content: 'The cumulative count of all logged events including door opens, closes, alarms, and system actions. View detailed event history in the Event Log page.'
    }
};

function showHelp(topic) {
    const help = helpContent[topic];
    if (!help) return;
    
    // Create or get help modal
    let modal = document.getElementById('helpModal');
    if (!modal) {
        modal = document.createElement('div');
        modal.id = 'helpModal';
        modal.className = 'modal fade';
        modal.setAttribute('tabindex', '-1');
        modal.setAttribute('role', 'dialog');
        modal.setAttribute('aria-labelledby', 'helpModalTitle');
        modal.setAttribute('aria-hidden', 'true');
        document.body.appendChild(modal);
    }
    
    modal.innerHTML = `
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="helpModalTitle">
                        <i class="fas fa-question-circle me-2" style="color: var(--accent-teal);"></i>
                        ${help.title}
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>${help.content}</p>
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Tip:</strong> Hover over any element for additional information, or press <kbd>?</kbd> to see keyboard shortcuts.
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    `;
    
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
}

// Skeleton Loader for Initial Load
function showSkeletonLoaders() {
    const grid = document.querySelector('.neo-grid');
    if (!grid) return;
    
    const originalContent = grid.innerHTML;
    grid.setAttribute('data-original-content', originalContent);
    
    grid.innerHTML = `
        <div class="neo-card skeleton-loader skeleton-card" aria-label="Loading" aria-busy="true"></div>
        <div class="neo-card skeleton-loader skeleton-card" aria-label="Loading" aria-busy="true"></div>
        <div class="neo-card skeleton-loader skeleton-card" aria-label="Loading" aria-busy="true"></div>
        <div class="neo-card skeleton-loader skeleton-card" aria-label="Loading" aria-busy="true"></div>
        <div class="neo-card skeleton-loader skeleton-card" aria-label="Loading" aria-busy="true"></div>
    `;
}

function hideSkeletonLoaders() {
    const grid = document.querySelector('.neo-grid');
    if (!grid) return;
    
    const originalContent = grid.getAttribute('data-original-content');
    if (originalContent) {
        grid.innerHTML = originalContent;
        grid.removeAttribute('data-original-content');
    }
}

// Keyboard shortcuts helper
document.addEventListener('keydown', function(event) {
    // Show keyboard shortcuts on '?'
    if (event.key === '?' && !event.ctrlKey && !event.altKey) {
        showKeyboardShortcuts();
        event.preventDefault();
    }
    
    // Ctrl+R for manual refresh
    if (event.ctrlKey && event.key === 'r' && !event.shiftKey) {
        event.preventDefault();
        manualRefresh();
    }
});

function showKeyboardShortcuts() {
    const shortcuts = {
        'Ctrl + R': 'Refresh dashboard data',
        '?': 'Show this help',
        'Esc': 'Stop all alarms (when playing)',
        'Tab': 'Navigate between elements',
        'Enter': 'Activate focused button/link'
    };
    
    let shortcutsHTML = '<dl class="row">';
    for (const [key, desc] of Object.entries(shortcuts)) {
        shortcutsHTML += `
            <dt class="col-sm-4"><kbd>${key}</kbd></dt>
            <dd class="col-sm-8">${desc}</dd>
        `;
    }
    shortcutsHTML += '</dl>';
    
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title">
                        <i class="fas fa-keyboard me-2"></i>Keyboard Shortcuts
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    ${shortcutsHTML}
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
    modal.addEventListener('hidden.bs.modal', () => modal.remove());
}

// Monitor online/offline status
window.addEventListener('online', () => {
    updateConnectionStatus('online');
    hideErrorMessage();
    console.log('üåê Connection restored');
});

window.addEventListener('offline', () => {
    updateConnectionStatus('offline');
    console.log('üåê Connection lost');
});

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    console.log('‚úÖ Phase 1 Enhancements Loaded: Error Handling, Loading States, Accessibility');
});

console.log('‚úÖ Phase 1 Critical Improvements Initialized');

// ============================================================================
// PHASE 2: USER ONBOARDING & ENHANCED NOTIFICATIONS
// ============================================================================

// User Onboarding Tour System
const tourSteps = [
    {
        element: '.system-info-bar',
        title: 'Welcome to eDOMOS!',
        content: 'This system bar shows uptime and connection status. The REFRESH button updates all data instantly.',
        position: 'bottom'
    },
    {
        element: '.quick-stats-bar',
        title: 'Key Metrics',
        content: 'Track today\'s events, compliance status, and blockchain verification in real-time.',
        position: 'bottom'
    },
    {
        element: '.neo-card.door-card',
        title: 'Door Status Monitor',
        content: 'Real-time door status. The indicator shows green (closed) or red (open). Click the help icon for more details.',
        position: 'right'
    },
    {
        element: '.neo-card.alarm-card',
        title: 'Alarm Status',
        content: 'Monitor alarm state. When the door is open too long, this will show "Active" with a red indicator.',
        position: 'right'
    },
    {
        element: '.neo-card.camera-card',
        title: 'Live Camera Feed',
        content: 'Click "View Feed" to access the real-time camera stream and monitor the door area visually.',
        position: 'left'
    },
    {
        element: '.btn-system-refresh',
        title: 'Manual Refresh',
        content: 'Click here or press Ctrl+R to manually refresh all dashboard data. The system also updates automatically.',
        position: 'bottom'
    }
];

let currentTourStep = 0;
let tourOverlay = null;
let tourTooltip = null;

function startOnboardingTour() {
    // Check if user has seen the tour
    if (localStorage.getItem('tourCompleted') === 'true') {
        return;
    }
    
    // Create tour overlay
    tourOverlay = document.createElement('div');
    tourOverlay.className = 'tour-overlay';
    tourOverlay.setAttribute('role', 'dialog');
    tourOverlay.setAttribute('aria-label', 'Onboarding tour');
    document.body.appendChild(tourOverlay);
    
    // Create tour tooltip
    tourTooltip = document.createElement('div');
    tourTooltip.className = 'tour-tooltip';
    tourTooltip.setAttribute('role', 'tooltip');
    document.body.appendChild(tourTooltip);
    
    currentTourStep = 0;
    showTourStep();
}

function showTourStep() {
    if (currentTourStep >= tourSteps.length) {
        completeTour();
        return;
    }
    
    const step = tourSteps[currentTourStep];
    const element = document.querySelector(step.element);
    
    if (!element) {
        currentTourStep++;
        showTourStep();
        return;
    }
    
    // Highlight element
    const rect = element.getBoundingClientRect();
    tourOverlay.innerHTML = '';
    
    // Create spotlight effect
    const spotlight = document.createElement('div');
    spotlight.className = 'tour-spotlight';
    spotlight.style.top = `${rect.top - 8}px`;
    spotlight.style.left = `${rect.left - 8}px`;
    spotlight.style.width = `${rect.width + 16}px`;
    spotlight.style.height = `${rect.height + 16}px`;
    tourOverlay.appendChild(spotlight);
    
    // Position tooltip
    const tooltipContent = `
        <div class="tour-header">
            <h3>${step.title}</h3>
            <span class="tour-step-indicator">${currentTourStep + 1}/${tourSteps.length}</span>
        </div>
        <div class="tour-body">
            <p>${step.content}</p>
        </div>
        <div class="tour-footer">
            <button class="btn btn-sm btn-secondary" onclick="skipTour()">Skip Tour</button>
            <div class="tour-navigation">
                ${currentTourStep > 0 ? '<button class="btn btn-sm btn-outline-light" onclick="previousTourStep()"><i class="fas fa-arrow-left"></i> Previous</button>' : ''}
                <button class="btn btn-sm btn-primary" onclick="nextTourStep()">
                    ${currentTourStep === tourSteps.length - 1 ? 'Finish' : 'Next'} <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    `;
    
    tourTooltip.innerHTML = tooltipContent;
    
    // Position tooltip based on step position
    positionTooltip(element, step.position);
    
    // Scroll element into view
    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function positionTooltip(element, position) {
    const rect = element.getBoundingClientRect();
    const tooltipRect = tourTooltip.getBoundingClientRect();
    
    let top, left;
    
    switch (position) {
        case 'bottom':
            top = rect.bottom + 16;
            left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
            break;
        case 'top':
            top = rect.top - tooltipRect.height - 16;
            left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
            break;
        case 'right':
            top = rect.top + (rect.height / 2) - (tooltipRect.height / 2);
            left = rect.right + 16;
            break;
        case 'left':
            top = rect.top + (rect.height / 2) - (tooltipRect.height / 2);
            left = rect.left - tooltipRect.width - 16;
            break;
        default:
            top = rect.bottom + 16;
            left = rect.left;
    }
    
    // Keep tooltip within viewport
    top = Math.max(16, Math.min(top, window.innerHeight - tooltipRect.height - 16));
    left = Math.max(16, Math.min(left, window.innerWidth - tooltipRect.width - 16));
    
    tourTooltip.style.top = `${top}px`;
    tourTooltip.style.left = `${left}px`;
}

function nextTourStep() {
    currentTourStep++;
    showTourStep();
}

function previousTourStep() {
    if (currentTourStep > 0) {
        currentTourStep--;
        showTourStep();
    }
}

function skipTour() {
    completeTour();
}

function completeTour() {
    if (tourOverlay) {
        tourOverlay.remove();
        tourOverlay = null;
    }
    if (tourTooltip) {
        tourTooltip.remove();
        tourTooltip = null;
    }
    
    localStorage.setItem('tourCompleted', 'true');
    
    showEnhancedNotification({
        title: 'Tour Complete!',
        message: 'You\'re all set! Press ? anytime to see keyboard shortcuts.',
        type: 'success',
        duration: 5000
    });
}

// Enhanced Notification System
function showEnhancedNotification(options) {
    const {
        title = '',
        message = '',
        type = 'info', // success, error, warning, info
        duration = 4000,
        action = null
    } = options;
    
    // Create notification container if it doesn't exist
    let container = document.getElementById('notificationContainer');
    if (!container) {
        container = document.createElement('div');
        container.id = 'notificationContainer';
        container.className = 'notification-container';
        container.setAttribute('aria-live', 'polite');
        container.setAttribute('aria-atomic', 'true');
        document.body.appendChild(container);
    }
    
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `enhanced-notification notification-${type}`;
    notification.setAttribute('role', 'status');
    
    const icons = {
        success: 'fa-check-circle',
        error: 'fa-exclamation-circle',
        warning: 'fa-exclamation-triangle',
        info: 'fa-info-circle'
    };
    
    notification.innerHTML = `
        <div class="notification-icon">
            <i class="fas ${icons[type]}"></i>
        </div>
        <div class="notification-content">
            ${title ? `<div class="notification-title">${title}</div>` : ''}
            <div class="notification-message">${message}</div>
        </div>
        ${action ? `
            <button class="notification-action" onclick="${action.callback}">
                ${action.label}
            </button>
        ` : ''}
        <button class="notification-close" onclick="this.parentElement.remove()" aria-label="Close notification">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    container.appendChild(notification);
    
    // Trigger animation
    setTimeout(() => notification.classList.add('show'), 10);
    
    // Auto remove
    if (duration > 0) {
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
        }, duration);
    }
    
    return notification;
}

// Check if first visit and show tour
setTimeout(() => {
    if (localStorage.getItem('tourCompleted') !== 'true') {
        startOnboardingTour();
    }
}, 2000);

// Add reset tour option (for testing/demo)
window.resetTour = function() {
    localStorage.removeItem('tourCompleted');
    showEnhancedNotification({
        title: 'Tour Reset',
        message: 'Refresh the page to see the onboarding tour again.',
        type: 'info'
    });
};

console.log('‚úÖ Phase 2: Onboarding & Notifications Loaded');

// ============================================================================
// NETWORK STATUS MONITORING
// ============================================================================

// Monitor online/offline status
window.addEventListener('online', function() {
    console.log('üåê Network connection restored');
    updateConnectionStatus('online');
    showEnhancedNotification({
        title: 'Connection Restored',
        message: 'You\'re back online! Data will sync automatically.',
        type: 'success',
        duration: 3000
    });
});

window.addEventListener('offline', function() {
    console.log('üî¥ Network connection lost');
    updateConnectionStatus('offline');
    showEnhancedNotification({
        title: 'Connection Lost',
        message: 'Working offline. Changes will sync when connection is restored.',
        type: 'warning',
        duration: 5000
    });
});

// Initialize connection status
document.addEventListener('DOMContentLoaded', function() {
    updateConnectionStatus(navigator.onLine ? 'online' : 'offline');
});

console.log('‚úÖ Network Status Monitoring Active');

// ============================================================================
// END PHASE 2 ENHANCEMENTS
// ============================================================================

// ============================================================================
// END PHASE 1 ENHANCEMENTS
// ============================================================================

// Add keyboard shortcut for emergency stop (ESC key)
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape' || event.keyCode === 27) {
        // Only trigger if an alarm is playing
        if (window.mobileAudioManager && window.mobileAudioManager.isPlaying) {
            console.log('‚å®Ô∏è ESC key pressed - Emergency stop triggered');
            emergencyStopAllAlarms();
            event.preventDefault();
        }
    }
});

// Add double-tap to stop (mobile friendly)
let lastTap = 0;
document.addEventListener('touchend', function(event) {
    const currentTime = new Date().getTime();
    const tapLength = currentTime - lastTap;
    
    if (tapLength < 500 && tapLength > 0) {
        // Double tap detected
        if (window.mobileAudioManager && window.mobileAudioManager.isPlaying) {
            console.log('üì± Double tap detected - Emergency stop triggered');
            emergencyStopAllAlarms();
            event.preventDefault();
        }
    }
    lastTap = currentTime;
});

// ============================================================================
// LIVE CAMERA FUNCTIONALITY
// ============================================================================

let cameraStream = null;
let cameraStatusInterval = null;

function openLiveCamera() {
    const button = document.getElementById('liveCameraBtn');
    
    // Toggle functionality
    if (cameraStream) {
        // Stop the camera
        stopLiveCamera();
        button.innerHTML = '<i class="fas fa-play"></i> View Live Feed';
        button.className = 'btn btn-primary btn-sm w-100';
        console.log('üõë Live camera stopped via toggle');
    } else {
        // Start the camera
        console.log('üé• Opening live camera feed...');
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('liveCameraModal'));
        modal.show();
        
        // Update button to show active state
        button.innerHTML = '<i class="fas fa-stop"></i> Stop Live Feed';
        button.className = 'btn btn-danger btn-sm w-100';
        
        // Check camera status first
        fetch('/api/camera/status')
            .then(response => response.json())
            .then(status => {
                if (status.available) {
                    startLiveStream();
                    updateModalStatus(status);
                    // Start status polling
                    cameraStatusInterval = setInterval(updateCameraStatus, 2000);
                } else {
                    showCameraError();
                    // Reset button on error
                    button.innerHTML = '<i class="fas fa-play"></i> View Live Feed';
                    button.className = 'btn btn-primary btn-sm w-100';
                }
            })
            .catch(error => {
                console.error('‚ùå Camera status error:', error);
                showCameraError();
                // Reset button on error
                button.innerHTML = '<i class="fas fa-play"></i> View Live Feed';
                button.className = 'btn btn-primary btn-sm w-100';
            });
    }
}

function startLiveStream() {
    console.log('üé• Starting live video stream...');
    
    const videoElement = document.getElementById('liveVideo');
    const statusElement = document.getElementById('cameraStatus');
    const containerElement = document.getElementById('cameraContainer');
    
    // Show container, hide status
    statusElement.style.display = 'none';
    containerElement.style.display = 'block';
    
    // Add timestamp to prevent caching
    const timestamp = new Date().getTime();
    const streamUrl = `/api/camera/stream?t=${timestamp}`;
    
    console.log('üìπ Stream URL:', streamUrl);
    
    // Set stream source
    videoElement.src = streamUrl;
    
    videoElement.onload = function() {
        console.log('‚úÖ Live stream connected');
        cameraStream = true;
    };
    
    videoElement.onerror = function(e) {
        console.error('‚ùå Live stream error:', e);
        console.error('   Stream URL:', streamUrl);
        console.error('   Error type:', e.type);
        showCameraError();
    };
    
    // Test if stream endpoint is accessible
    fetch(streamUrl, { method: 'HEAD' })
        .then(response => {
            console.log('üì° Stream endpoint status:', response.status);
            if (!response.ok) {
                console.error('‚ùå Stream endpoint returned error:', response.status);
                showCameraError();
            }
        })
        .catch(error => {
            console.error('‚ùå Cannot reach stream endpoint:', error);
            showCameraError();
        });
}

function stopLiveCamera() {
    console.log('üõë Stopping live camera feed...');
    
    const videoElement = document.getElementById('liveVideo');
    const button = document.getElementById('liveCameraBtn');
    
    if (cameraStream) {
        videoElement.src = '';
        cameraStream = null;
    }
    
    // Clear status polling
    if (cameraStatusInterval) {
        clearInterval(cameraStatusInterval);
        cameraStatusInterval = null;
    }
    
    // Reset button state
    if (button) {
        button.innerHTML = '<i class="fas fa-play"></i> View Live Feed';
        button.className = 'btn btn-primary btn-sm w-100';
    }
    
    // Hide modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('liveCameraModal'));
    if (modal) {
        modal.hide();
    }
}

function takeSnapshot() {
    console.log('üì∏ Taking camera snapshot...');
    
    fetch('/api/camera/snapshot')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Create a new window/tab with the snapshot
                const newWindow = window.open('', '_blank');
                newWindow.document.write(`
                    <html>
                        <head><title>eDOMOS Camera Snapshot - ${data.timestamp}</title></head>
                        <body style="margin:0; background:#000; display:flex; justify-content:center; align-items:center; min-height:100vh;">
                            <div style="text-align:center; color:#fff;">
                                <h3>eDOMOS Camera Snapshot</h3>
                                <p>Captured: ${data.timestamp}</p>
                                <p>Door Status: ${data.door_status.toUpperCase()}</p>
                                <img src="${data.image}" style="max-width:90vw; max-height:80vh; border:2px solid #333;">
                                <br><br>
                                <button onclick="window.close()" style="padding:10px 20px; background:#007bff; color:white; border:none; border-radius:5px;">Close</button>
                            </div>
                        </body>
                    </html>
                `);
                showNotification('Snapshot captured successfully!', 'success');
            } else {
                showNotification('Failed to capture snapshot: ' + data.error, 'error');
            }
        })
        .catch(error => {
            console.error('‚ùå Snapshot error:', error);
            showNotification('Snapshot error: ' + error.message, 'error');
        });
}

function updateCameraStatus() {
    fetch('/api/camera/status')
        .then(response => response.json())
        .then(status => {
            updateModalStatus(status);
        })
        .catch(error => {
            console.error('‚ùå Camera status update error:', error);
        });
}

function updateModalStatus(status) {
    const doorStatusElement = document.getElementById('modalDoorStatus');
    const alarmStatusElement = document.getElementById('modalAlarmStatus');
    
    if (doorStatusElement) {
        doorStatusElement.textContent = status.door_status.toUpperCase();
        doorStatusElement.className = `badge ${status.door_status === 'open' ? 'bg-warning' : 'bg-success'}`;
    }
    
    if (alarmStatusElement) {
        alarmStatusElement.textContent = status.alarm_status.toUpperCase();
        alarmStatusElement.className = `badge ${status.alarm_status === 'active' ? 'bg-danger' : 'bg-success'}`;
    }
}

function showCameraError() {
    console.log('‚ùå Showing camera error message');
    document.getElementById('cameraStatus').style.display = 'none';
    document.getElementById('cameraContainer').style.display = 'none';
    
    const errorElement = document.getElementById('cameraError');
    errorElement.innerHTML = `
        <i class="fas fa-exclamation-triangle"></i>
        <strong>Camera Stream Error</strong><br>
        <small>The camera stream is currently not available. Possible causes:</small>
        <ul class="small mt-2 mb-0">
            <li>Camera is not connected or powered on</li>
            <li>Another application is using the camera</li>
            <li>Camera permissions not granted</li>
            <li>Server camera service is not running</li>
        </ul>
        <div class="mt-3">
            <button class="btn btn-sm btn-primary" onclick="window.location.reload()">
                <i class="fas fa-sync-alt me-1"></i>Refresh Page
            </button>
            <button class="btn btn-sm btn-secondary" onclick="testCameraEndpoint()">
                <i class="fas fa-flask me-1"></i>Test Connection
            </button>
        </div>
    `;
    errorElement.style.display = 'block';
}

function testCameraEndpoint() {
    console.log('üß™ Testing camera endpoint...');
    
    fetch('/api/camera/snapshot')
        .then(response => {
            console.log('üì° Camera endpoint response:', response.status);
            if (response.ok) {
                alert('‚úÖ Camera endpoint is accessible! Try viewing the stream again.');
                return response.json();
            } else {
                alert('‚ùå Camera endpoint returned error: ' + response.status);
                throw new Error('Camera endpoint error: ' + response.status);
            }
        })
        .then(data => {
            console.log('üì∏ Snapshot data:', data);
        })
        .catch(error => {
            console.error('‚ùå Camera test failed:', error);
            alert('‚ùå Cannot connect to camera: ' + error.message);
        });
}

// Auto-stop camera when modal is closed
document.getElementById('liveCameraModal').addEventListener('hidden.bs.modal', function() {
    const button = document.getElementById('liveCameraBtn');
    
    if (cameraStream) {
        stopLiveCamera();
    }
    
    // Ensure button is reset when modal closes
    if (button) {
        button.innerHTML = '<i class="fas fa-play"></i> View Live Feed';
        button.className = 'btn btn-primary btn-sm w-100';
    }
});

console.log('‚úÖ Live Camera System Loaded');
</script>

<!-- Industrial Footer -->
<footer class="industrial-footer">
    <div class="footer-content">
        <div class="footer-section">
            <i class="fas fa-shield-alt"></i>
            <span>eDOMOS v2.1.0</span>
        </div>
        <div class="footer-section">
            <i class="fas fa-certificate"></i>
            <span>21 CFR Part 11 Compliant</span>
        </div>
        <div class="footer-section">
            <i class="fas fa-copyright"></i>
            <span>2025 eDOMOS Industrial Solutions</span>
        </div>
        <div class="footer-section ms-auto">
            <span class="footer-link" onclick="window.open('/docs', '_blank')">Documentation</span>
            <span class="footer-separator">|</span>
            <span class="footer-link" onclick="window.open('/support', '_blank')">Support</span>
        </div>
    </div>
</footer>

<!-- Real-Time Dashboard Updates -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard-realtime.css') }}">
<script src="{{ url_for('static', filename='js/dashboard-realtime.js') }}"></script>

<!-- System Uptime Counter -->
<script>
let systemStartTime = Date.now();

function updateSystemUptime() {
    const uptime = Date.now() - systemStartTime;
    const hours = Math.floor(uptime / 3600000);
    const minutes = Math.floor((uptime % 3600000) / 60000);
    const seconds = Math.floor((uptime % 60000) / 1000);
    
    const uptimeElement = document.getElementById('systemUptime');
    if (uptimeElement) {
        uptimeElement.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }
    
    const lastUpdate = document.getElementById('lastUpdateTime');
    if (lastUpdate) {
        const now = new Date();
        lastUpdate.textContent = now.toLocaleTimeString('en-US', { hour12: false });
    }
}

// Update uptime every second
setInterval(updateSystemUptime, 1000);
updateSystemUptime();

// ============================================================================
// MOBILE TOUCH OPTIMIZATIONS
// ============================================================================

// Check if device is mobile
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

if (isMobile) {
    console.log('üì± Mobile device detected - Enabling touch optimizations');
    
    // Add mobile bottom navigation
    const bottomNav = document.createElement('nav');
    bottomNav.className = 'mobile-bottom-nav';
    bottomNav.setAttribute('aria-label', 'Mobile navigation');
    bottomNav.innerHTML = `
        <a href="/dashboard" class="mobile-nav-item active" aria-label="Dashboard">
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
        </a>
        <a href="/events" class="mobile-nav-item" aria-label="Events">
            <i class="fas fa-list"></i>
            <span>Events</span>
        </a>
        <a href="/analytics" class="mobile-nav-item" aria-label="Analytics">
            <i class="fas fa-chart-line"></i>
            <span>Analytics</span>
        </a>
        <a href="/settings" class="mobile-nav-item" aria-label="Settings">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </a>
    `;
    document.body.appendChild(bottomNav);
    
    // Add swipe gesture support for cards
    const cards = document.querySelectorAll('.neo-card');
    cards.forEach(card => {
        let touchStartX = 0;
        let touchEndX = 0;
        let touchStartY = 0;
        let touchEndY = 0;
        
        card.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
            card.classList.add('swiping');
        }, { passive: true });
        
        card.addEventListener('touchmove', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            
            // Calculate horizontal swipe distance
            const deltaX = touchEndX - touchStartX;
            const deltaY = Math.abs(touchEndY - touchStartY);
            
            // Only transform if horizontal swipe is dominant
            if (Math.abs(deltaX) > deltaY && Math.abs(deltaX) > 10) {
                card.style.transform = `translateX(${deltaX * 0.5}px)`;
            }
        }, { passive: true });
        
        card.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            card.classList.remove('swiping');
            
            const swipeDistance = touchEndX - touchStartX;
            const swipeVertical = Math.abs(touchEndY - touchStartY);
            
            // Reset transform
            card.style.transform = '';
            
            // Detect swipe gesture (minimum 100px horizontal, less than 50px vertical)
            if (Math.abs(swipeDistance) > 100 && swipeVertical < 50) {
                if (swipeDistance > 0) {
                    // Swipe right - could show additional info
                    console.log('üëâ Swiped right on card');
                    card.style.transform = 'scale(1.02)';
                    setTimeout(() => card.style.transform = '', 200);
                } else {
                    // Swipe left - could hide or dismiss
                    console.log('üëà Swiped left on card');
                    card.style.transform = 'scale(0.98)';
                    setTimeout(() => card.style.transform = '', 200);
                }
            }
        }, { passive: true });
    });
    
    // PWA Install Prompt
    let deferredPrompt;
    
    window.addEventListener('beforeinstallprompt', (e) => {
        // Prevent the mini-infobar from appearing on mobile
        e.preventDefault();
        // Stash the event so it can be triggered later
        deferredPrompt = e;
        
        // Show custom install prompt after 5 seconds
        setTimeout(() => {
            showPWAInstallPrompt();
        }, 5000);
    });
    
    function showPWAInstallPrompt() {
        // Check if user already dismissed the prompt
        if (localStorage.getItem('pwaPromptDismissed') === 'true') {
            return;
        }
        
        const prompt = document.createElement('div');
        prompt.className = 'pwa-install-prompt show';
        prompt.innerHTML = `
            <div class="pwa-prompt-content">
                <div class="pwa-prompt-icon">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                <div class="pwa-prompt-text">
                    <h4>Install eDOMOS App</h4>
                    <p>Add to home screen for quick access and offline use</p>
                </div>
            </div>
            <div class="pwa-prompt-actions">
                <button class="btn btn-secondary btn-sm" onclick="dismissPWAPrompt()">
                    Not Now
                </button>
                <button class="btn btn-primary btn-sm" onclick="installPWA()">
                    <i class="fas fa-download"></i> Install
                </button>
            </div>
        `;
        document.body.appendChild(prompt);
    }
    
    window.installPWA = async function() {
        if (!deferredPrompt) return;
        
        // Show the install prompt
        deferredPrompt.prompt();
        
        // Wait for the user to respond
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`üì≤ PWA install outcome: ${outcome}`);
        
        if (outcome === 'accepted') {
            showEnhancedNotification({
                title: 'App Installing',
                message: 'eDOMOS will be available on your home screen shortly.',
                type: 'success'
            });
        }
        
        // Remove the prompt
        deferredPrompt = null;
        document.querySelector('.pwa-install-prompt')?.remove();
    };
    
    window.dismissPWAPrompt = function() {
        localStorage.setItem('pwaPromptDismissed', 'true');
        document.querySelector('.pwa-install-prompt')?.remove();
    };
    
    // Track install event
    window.addEventListener('appinstalled', () => {
        console.log('‚úÖ PWA was installed successfully');
        showEnhancedNotification({
            title: 'App Installed!',
            message: 'eDOMOS is now available on your home screen.',
            type: 'success',
            duration: 5000
        });
    });
    
    console.log('‚úÖ Mobile touch optimizations enabled');
}

// Reset PWA prompt (for testing)
window.resetPWAPrompt = function() {
    localStorage.removeItem('pwaPromptDismissed');
    showEnhancedNotification({
        title: 'PWA Prompt Reset',
        message: 'Refresh the page to see the install prompt again.',
        type: 'info'
    });
};

console.log('‚úÖ Phase 2: Mobile Touch Optimizations Complete');

</script>

{% endblock %}
