{% extends "base.html" %}

{% block title %}Blockchain Demo - eDOMOS{% endblock %}

{% block content %}
<style>
    .demo-section {
        background: linear-gradient(135deg, rgba(0, 255, 157, 0.1) 0%, rgba(0, 212, 255, 0.1) 100%);
        border: 2px solid #00ff9d;
        border-radius: 15px;
        padding: 30px;
        margin: 20px 0;
    }
    
    .blockchain-visual {
        display: flex;
        gap: 20px;
        overflow-x: auto;
        padding: 20px 0;
    }
    
    .block-box {
        min-width: 250px;
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid #00ff9d;
        border-radius: 10px;
        padding: 15px;
        position: relative;
    }
    
    .block-box::after {
        content: '→';
        position: absolute;
        right: -30px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 24px;
        color: #00ff9d;
    }
    
    .block-box:last-child::after {
        content: '';
    }
    
    .hash-display {
        font-family: 'Courier New', monospace;
        font-size: 0.75rem;
        background: rgba(0, 0, 0, 0.5);
        padding: 8px;
        border-radius: 5px;
        word-break: break-all;
        margin: 10px 0;
    }
    
    .proof-badge {
        background: linear-gradient(135deg, #00ff9d 0%, #00d4ff 100%);
        color: #000;
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        margin: 30px 0;
        box-shadow: 0 0 30px rgba(0, 255, 157, 0.5);
    }
    
    .verification-result {
        background: rgba(0, 255, 157, 0.2);
        border: 2px solid #00ff9d;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        text-align: center;
    }
    
    .feature-list {
        list-style: none;
        padding: 0;
    }
    
    .feature-list li {
        padding: 10px;
        margin: 10px 0;
        background: rgba(255, 255, 255, 0.05);
        border-left: 4px solid #00ff9d;
        border-radius: 5px;
    }
    
    .animate-pulse {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
</style>

<div class="container-fluid mt-4">
    <div class="text-center mb-5">
        <h1><i class="fas fa-link"></i> BLOCKCHAIN-SECURED SYSTEM</h1>
        <p class="lead text-muted">Tamper-Proof, Cryptographically-Verified Event Logging</p>
    </div>
    
    <!-- Proof Badge -->
    <div class="proof-badge">
        <h2><i class="fas fa-shield-alt"></i> BLOCKCHAIN VERIFIED</h2>
        <h1 id="demoTotalBlocks" class="display-3">-</h1>
        <h4>Cryptographically Secured Blocks</h4>
        <p style="margin-top: 20px; font-size: 1.1rem;">
            <i class="fas fa-check-circle"></i> <strong>Status:</strong> <span id="demoVerificationStatus">Verifying...</span>
        </p>
        <p style="font-size: 0.9rem; margin-top: 10px;">
            Last Verified: <span id="demoLastVerified">Just now</span>
        </p>
    </div>
    
    <!-- What is Blockchain Section -->
    <div class="demo-section">
        <h3><i class="fas fa-question-circle me-2"></i>What Makes This System Unique?</h3>
        <div class="row mt-4">
            <div class="col-md-6">
                <h5><i class="fas fa-times-circle text-danger me-2"></i>Traditional Systems:</h5>
                <ul class="feature-list">
                    <li><i class="fas fa-times text-danger me-2"></i> Regular database - can be modified</li>
                    <li><i class="fas fa-times text-danger me-2"></i> Logs can be deleted</li>
                    <li><i class="fas fa-times text-danger me-2"></i> No tamper detection</li>
                    <li><i class="fas fa-times text-danger me-2"></i> Evidence can be disputed</li>
                    <li><i class="fas fa-times text-danger me-2"></i> No cryptographic proof</li>
                </ul>
            </div>
            <div class="col-md-6">
                <h5><i class="fas fa-check-circle" style="color: #00ff9d;" me-2></i>eDOMOS Blockchain:</h5>
                <ul class="feature-list">
                    <li><i class="fas fa-check" style="color: #00ff9d;" me-2></i> Tamper-proof blockchain - modifications detected instantly</li>
                    <li><i class="fas fa-check" style="color: #00ff9d;" me-2></i> Immutable - events cannot be deleted</li>
                    <li><i class="fas fa-check" style="color: #00ff9d;" me-2></i> Real-time integrity verification</li>
                    <li><i class="fas fa-check" style="color: #00ff9d;" me-2></i> Court-admissible evidence</li>
                    <li><i class="fas fa-check" style="color: #00ff9d;" me-2></i> SHA-256 cryptographic proof</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Live Blockchain Visualization -->
    <div class="demo-section">
        <h3><i class="fas fa-cubes me-2"></i>Live Blockchain Chain</h3>
        <p class="text-muted">See how each event is cryptographically linked to the previous one</p>
        <div class="blockchain-visual" id="blockchainVisual">
            <div class="text-center text-muted" style="width: 100%;">
                <i class="fas fa-spinner fa-spin"></i> Loading blockchain...
            </div>
        </div>
    </div>
    
    <!-- Live Verification Demo -->
    <div class="demo-section">
        <h3><i class="fas fa-check-double me-2"></i>Live Integrity Verification</h3>
        <p class="text-muted">Verify that no events have been tampered with</p>
        
        <div class="text-center my-4">
            <button class="btn btn-success btn-lg" onclick="runLiveVerification()">
                <i class="fas fa-sync"></i> Verify Blockchain Now
            </button>
        </div>
        
        <div id="verificationDemo" class="verification-result" style="display: none;">
            <h4><i class="fas fa-shield-check" style="color: #00ff9d;"></i> Verification Complete</h4>
            <p class="lead" id="verificationMessage">-</p>
            <div class="mt-3">
                <p><strong>Blocks Verified:</strong> <span id="verifiedBlocks">-</span></p>
                <p><strong>Corrupted Blocks:</strong> <span id="corruptedBlocks">0</span></p>
                <p><strong>Verification Time:</strong> <span id="verificationTime">-</span>ms</p>
            </div>
        </div>
    </div>
    
    <!-- Export Proof Section -->
    <div class="demo-section">
        <h3><i class="fas fa-download me-2"></i>Export Cryptographic Proof</h3>
        <p class="text-muted">Download blockchain proof for legal evidence or compliance audits</p>
        
        <div class="text-center my-4">
            <button class="btn btn-primary btn-lg" onclick="exportProof()">
                <i class="fas fa-file-download"></i> Download Blockchain Certificate
            </button>
        </div>
        
        <div class="mt-4">
            <h5>What's Included in the Proof:</h5>
            <ul class="feature-list">
                <li><i class="fas fa-check me-2" style="color: #00ff9d;"></i> Complete blockchain data with all event hashes</li>
                <li><i class="fas fa-check me-2" style="color: #00ff9d;"></i> Cryptographic signature for verification</li>
                <li><i class="fas fa-check me-2" style="color: #00ff9d;"></i> Timestamp of export</li>
                <li><i class="fas fa-check me-2" style="color: #00ff9d;"></i> Verification status and integrity report</li>
                <li><i class="fas fa-check me-2" style="color: #00ff9d;"></i> JSON format for third-party verification</li>
            </ul>
        </div>
    </div>
    
    <!-- Compliance Section -->
    <div class="demo-section">
        <h3><i class="fas fa-balance-scale me-2"></i>Regulatory Compliance & Legal Value</h3>
        <div class="row mt-4 justify-content-center">
            <div class="col-6 col-md-4 col-lg mb-3">
                <div class="text-center">
                    <i class="fas fa-hospital" style="font-size: 2.5rem; color: #00ff9d;"></i>
                    <h5 class="mt-3">HIPAA</h5>
                    <p class="small">Healthcare facility access control</p>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg mb-3">
                <div class="text-center">
                    <i class="fas fa-shield-alt" style="font-size: 2.5rem; color: #00ff9d;"></i>
                    <h5 class="mt-3">GDPR</h5>
                    <p class="small">EU privacy compliance</p>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg mb-3">
                <div class="text-center">
                    <i class="fas fa-university" style="font-size: 2.5rem; color: #00ff9d;"></i>
                    <h5 class="mt-3">SOX</h5>
                    <p class="small">Financial audit integrity</p>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg mb-3">
                <div class="text-center">
                    <i class="fas fa-certificate" style="font-size: 2.5rem; color: #00ff9d;"></i>
                    <h5 class="mt-3">ISO 27001</h5>
                    <p class="small">InfoSec management</p>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg mb-3">
                <div class="text-center">
                    <i class="fas fa-flag-usa" style="font-size: 2.5rem; color: #00ff9d;"></i>
                    <h5 class="mt-3">NIST CSF</h5>
                    <p class="small">U.S. Federal Standard</p>
                </div>
            </div>
        </div>
        <div class="mt-4 text-center">
            <a href="/hipaa-compliance" class="btn btn-outline-light">
                <i class="fas fa-file-alt me-2"></i>View Full Compliance Documentation
            </a>
        </div>
    </div>
    
    <!-- Call to Action -->
    <div class="text-center my-5">
        <h2>Interested in Learning More?</h2>
        <p class="lead text-muted">Contact us to see how blockchain-verified security can protect your facility</p>
        <a href="/blockchain" class="btn btn-success btn-lg me-3">
            <i class="fas fa-chart-line"></i> View Full Blockchain Dashboard
        </a>
        <button class="btn btn-outline-light btn-lg" onclick="window.print()">
            <i class="fas fa-print"></i> Print This Demo
        </button>
    </div>
</div>

<script>
// Load demo data on page load
document.addEventListener('DOMContentLoaded', function() {
    loadDemoStats();
    loadBlockchainVisualization();
});

function loadDemoStats() {
    fetch('/api/blockchain/stats')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('demoTotalBlocks').textContent = data.total_blocks || 0;
                
                const statusElement = document.getElementById('demoVerificationStatus');
                if (data.verified) {
                    statusElement.innerHTML = '<span style="color: #00ff9d;">✓ ALL BLOCKS VERIFIED</span>';
                } else {
                    statusElement.innerHTML = '<span style="color: #ff4444;">⚠ VERIFICATION NEEDED</span>';
                }
                
                document.getElementById('demoLastVerified').textContent = new Date().toLocaleString();
            }
        });
}

function loadBlockchainVisualization() {
    fetch('/api/blockchain/events?limit=5')
        .then(response => response.json())
        .then(data => {
            if (data.success && data.events.length > 0) {
                const visual = document.getElementById('blockchainVisual');
                visual.innerHTML = data.events.reverse().map(event => `
                    <div class="block-box">
                        <div><strong>Block #${event.block_index}</strong></div>
                        <div style="color: #00ff9d; margin: 10px 0;">
                            <i class="fas fa-${event.event_type === 'door_open' ? 'door-open' : event.event_type === 'door_close' ? 'door-closed' : 'exclamation-triangle'}"></i>
                            ${event.event_type}
                        </div>
                        <div class="hash-display">
                            <strong>Hash:</strong><br>
                            ${event.block_hash.substring(0, 16)}...
                        </div>
                        <div class="hash-display">
                            <strong>Prev:</strong><br>
                            ${event.previous_hash.substring(0, 16)}...
                        </div>
                        <small class="text-muted">${event.timestamp}</small>
                    </div>
                `).join('');
            }
        });
}

function runLiveVerification() {
    const demoDiv = document.getElementById('verificationDemo');
    const messageDiv = document.getElementById('verificationMessage');
    
    demoDiv.style.display = 'block';
    messageDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying blockchain integrity...';
    
    const startTime = Date.now();
    
    fetch('/api/blockchain/verify')
        .then(response => response.json())
        .then(data => {
            const endTime = Date.now();
            const duration = endTime - startTime;
            
            if (data.success) {
                if (data.verified) {
                    messageDiv.innerHTML = '<i class="fas fa-check-circle" style="color: #00ff9d;"></i> ' + data.message;
                    document.getElementById('verifiedBlocks').textContent = data.message.match(/\d+/)[0];
                    document.getElementById('corruptedBlocks').textContent = '0';
                    document.getElementById('corruptedBlocks').style.color = '#00ff9d';
                } else {
                    messageDiv.innerHTML = '<i class="fas fa-exclamation-triangle" style="color: #ff4444;"></i> ' + data.message;
                    document.getElementById('corruptedBlocks').textContent = data.corrupted_blocks.length;
                    document.getElementById('corruptedBlocks').style.color = '#ff4444';
                }
                document.getElementById('verificationTime').textContent = duration;
            }
        });
}

function exportProof() {
    const button = event.target;
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
    
    fetch('/api/blockchain/export')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Create downloadable JSON
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `eDOMOS_Blockchain_Certificate_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                alert('✅ Blockchain certificate downloaded!\n\nThis file contains cryptographic proof of all events and can be used for legal evidence or compliance audits.');
            }
        })
        .finally(() => {
            button.disabled = false;
            button.innerHTML = '<i class="fas fa-file-download"></i> Download Blockchain Certificate';
        });
}
</script>
{% endblock %}
